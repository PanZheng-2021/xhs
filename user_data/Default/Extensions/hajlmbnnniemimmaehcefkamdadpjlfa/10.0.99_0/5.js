(window.webpackJsonp=window.webpackJsonp||[]).push([[5,35,37,40],{163:function(t,e,o){"use strict";o.r(e),o.d(e,"slave",(function(){return a}));o(8),o(11),o(14),o(41);var i=o(6),n=o.n(i),s=o(276),r=o(59);const a=new class{constructor(){if(this.channel=null,this.initResolve=[],this.initReject=[],this.messageScheduler=new s.a,this.initChannel=()=>{"serviceworker"===r.b?this.initServiceworker():"background"===r.b&&this.initBackground()},this.awaitChannel=()=>new n.a(async(t,e)=>{"serviceworker"===r.b?this.channel?(await this.channel.active,await this.channel.controlling,t(null)):(this.initResolve.push(t),this.initReject.push(e)):"background"===r.b&&t(null)}),this.initServiceworker=async()=>{try{const{createWorkBox:t}=await o.e(11).then(o.bind(null,615)),e=await t();if(!e)return;e.addEventListener("message",t=>{const{type:e,payload:o={}}=t.data;"master:bordcast-message"===e&&this.messageScheduler.execTask(o.type,o.payload)}),await e.active,await e.controlling,this.channel=e,this.initResolve.forEach(t=>{t()}),this.channel.postTask=this.channel.messageSW}catch(t){console.log("slave初始化错误：",t),this.initReject.forEach(t=>{t()})}},this.initBackground=()=>{this.channel={postTask:t=>new n.a((e,o)=>{chrome.runtime.sendMessage(t,t=>{chrome.runtime.lastError&&o(chrome.runtime.lastError),e(t)})})},chrome.runtime.onMessage.addListener(({type:t,payload:e,ignoreId:o})=>{"master:bordcast-message"===t?chrome.tabs.getCurrent(t=>{o!==t.id&&this.messageScheduler.execTask(e.type,e.payload)}):"slave:bordcast-message"===t&&this.messageScheduler.execTask(e.data.type,e.data.payload)})},r.a)throw new Error("it's not page");this.initChannel()}postTask(t,e,o){return new n.a(async(i,n)=>{let s=!1;await this.awaitChannel();const a=Object.assign(Object.assign(Object.assign({},r.d),{taskId:Object(r.c)()}),o);a.timeout&&setTimeout(()=>{s||i({error:"timeout"})},a.timeout);try{const o=await this.channel.postTask({type:t,payload:Object.assign({data:e},a)});s=!0,i(o)}catch(t){i({error:t})}})}listenMessage(t,e){this.messageScheduler.listenTask(t,e)}sendMessage(t,e=""){this.postTask("slave:bordcast-message",{type:t,payload:e})}}},23:function(t,e,o){"use strict";o.d(e,"i",(function(){return i})),o.d(e,"d",(function(){return n})),o.d(e,"h",(function(){return O})),o.d(e,"b",(function(){return s})),o.d(e,"a",(function(){return r})),o.d(e,"g",(function(){return a})),o.d(e,"e",(function(){return l})),o.d(e,"f",(function(){return Nt})),o.d(e,"c",(function(){return c}));var i={};o.r(i),o.d(i,"getLocalCity",(function(){return h})),o.d(i,"getForecastWeather",(function(){return p})),o.d(i,"getCityList",(function(){return g}));var n={};o.r(n),o.d(n,"getSearchSuggest",(function(){return k})),o.d(n,"getEnginesList",(function(){return v}));var s={};o.r(s),o.d(s,"getIcon",(function(){return q})),o.d(s,"getUrlInfoWithPermission",(function(){return D})),o.d(s,"getUrlIcon",(function(){return $})),o.d(s,"getFetchiconUrls",(function(){return F})),o.d(s,"getLogoList",(function(){return W})),o.d(s,"getRedirectTargets",(function(){return V}));var r={};o.r(r),o.d(r,"getUnreadEmails",(function(){return G}));var a={};o.r(a),o.d(a,"register",(function(){return Q})),o.d(a,"login",(function(){return Y})),o.d(a,"updateProfile",(function(){return Z})),o.d(a,"getUserProfile",(function(){return tt})),o.d(a,"uploadAvatar",(function(){return et})),o.d(a,"modifyPassword",(function(){return ot})),o.d(a,"forgetPassword",(function(){return it})),o.d(a,"resetPassword",(function(){return nt})),o.d(a,"getEmailCode",(function(){return st})),o.d(a,"getRegisterCode",(function(){return rt})),o.d(a,"inspceCode",(function(){return at})),o.d(a,"checkTokenIsExpired",(function(){return ct})),o.d(a,"deleteAccount",(function(){return lt})),o.d(a,"loginWithUid",(function(){return ut})),o.d(a,"v1BasicLogin",(function(){return dt})),o.d(a,"getMobileUid",(function(){return ht})),o.d(a,"getMobileloginUrl",(function(){return pt})),o.d(a,"checkMobileloginUrl",(function(){return gt})),o.d(a,"sendPhoneCode",(function(){return yt})),o.d(a,"sendEmailCode",(function(){return mt})),o.d(a,"bindEmail",(function(){return ft})),o.d(a,"bindPhoneNumber",(function(){return bt})),o.d(a,"unbindEmail",(function(){return wt})),o.d(a,"unbindPhoneNumber",(function(){return kt})),o.d(a,"verifyPhoneVCode",(function(){return vt})),o.d(a,"ThirdLoginType",(function(){return St})),o.d(a,"bindThird",(function(){return Tt})),o.d(a,"unbindThird",(function(){return _t})),o.d(a,"getAreaCodeList",(function(){return xt})),o.d(a,"verifyPassword",(function(){return Lt})),o.d(a,"geVerifyTokenImg",(function(){return Ot}));var c={};o.r(c),o.d(c,"getRepairConcat",(function(){return jt})),o.d(c,"postErrorCollect",(function(){return Mt})),o.d(c,"sendLog",(function(){return Pt}));var l={};o.r(l),o.d(l,"getSyncList",(function(){return Ct})),o.d(l,"getSyncDetail",(function(){return qt})),o.d(l,"autoBackup",(function(){return Bt})),o.d(l,"manualBackup",(function(){return Ut})),o.d(l,"getV2DataFromV1",(function(){return Dt}));o(8);var u=o(0),d=o(3);const h=async()=>{try{const t=await d.a.get(u.A+"/city/locate",{lang:u.D.lang},{timeout:1e4});if(t&&t.city)return{data:t.city}}catch(t){return{error:t}}},p=async t=>{try{return{data:(await d.a.get(u.A+"/weather/forecast",{lang:u.D.lang,cid:t},{timeout:1e4})).forecast}}catch(t){return{error:t}}},g=async t=>{try{return{data:await d.a.get(u.A+"/city/list",{lang:u.D.lang,searchkey:t},{timeout:1e4})}}catch(t){return{error:t}}};o(21);var y=o(17),m=o(87),f=o.n(m),b=o(252),w=o.n(b);const k=async t=>u.D.isZh?u.h||u.s?T(t):x(t):u.h||u.s?_(t):L(t),v=async t=>{let e=u.q?36e5:6e4;t||(e=0);try{if(!y.a.requestFirefoxThrottle("/search/list",e,!0))return{error:"request throttle error"};const o=await d.a.get(u.y+"/search/list",{lang:u.D.lang,platform:u.D.platform,platformVersion:u.D.platformVersion,edition:u.e,maybe360:u.G,version:t||""+Date.now()});if(0===o.code){const t=o.data.map(t=>{const e={};return e.name=t.name,e.uuid=t.seId,e.logo=t.logo,e.desc=t.desc,e.types=t.types,e.hide=t.hide,e});return y.a.requestFirefoxThrottle("/search/list",!0,!0),{data:{list:t,hash:f()(JSON.stringify(t)),meta:o.meta}}}if(2005===o.code)return y.a.requestFirefoxThrottle("/search/list",!0,!0),{error:o};throw o}catch(t){return{error:t}}},S=y.a.getLastReqValue(d.a.jsonp),T=async t=>{var e;try{const o=await S(u.b+"/su?ie=utf-8&p=3",{wd:t},{adapter:w.a,callbackParamName:"cb"});return{data:(null===(e=null==o?void 0:o.s)||void 0===e?void 0:e.map(t=>({text:t})))||[]}}catch(t){return{error:t}}},_=async t=>{var e;try{const o=await S(u.g+"/complete/search?client=chrome",{q:t},{adapter:w.a,callbackParamName:"jsonp"});return{data:(null==o?void 0:o.length)&&(null===(e=o[1])||void 0===e?void 0:e.length)?o[1].map(t=>({text:t})):[]}}catch(t){return{error:t}}},x=async t=>{try{const e=await d.a.get(u.b+"/su?p=3&ie=UTF-8&cb=",{wd:t},{_single:!0,_delay:0}),o=/s:(\[[\w\W]*\])/.exec(e),i=JSON.parse(o[1]);return{data:i.map(t=>({text:t}))}}catch(t){return{error:t}}},L=async t=>{try{const e=await d.a.get(u.g+"/complete/search?client=chrome",{q:t},{_single:!0,_delay:200});return{data:e[2].map((t,o)=>(t||(t=e[1][o]),{text:t}))}}catch(t){return{error:t}}};var O=o(119),j=o(6),M=o.n(j),P=o(99),I=o.n(P),R=o(36),E=o.n(R);o(41),o(266),o(11),o(14),o(64);const C=u.D.lang,q=async({page:t=0,type:e,keyword:o,source:i}={})=>{try{const n=await d.a.get(u.x+"/get-icons",{lang:C,page:t,type:e,source:i,keyword:o},{_single:!0,_delay:200});if(n.success)return n.icons.forEach(t=>{if("infinity"===t.source)switch("infinity://wallpaper"===t.url&&(t.name="wallpaper_library"),t.url){case"infinity://wallpaper":case"infinity://weather":case"infinity://todos":case"infinity://notes":case"infinity://history":case"infinity://bookmarks":case"infinity://settings":t.name=i18n(t.name),t.description=i18n(t.description);break;case"infinity://extension":t.name=i18n(t.name),t.description=i18n(t.description,u.D.vendor)}t._footer=t.description||i18n("no_description")}),{data:n};throw n}catch(t){return{error:t}}},B=async t=>{try{const e=await d.a.get(u.y+"/icon/title",{url:t},{_single:!0,_delay:0,timeout:3e3});if(0===e.code)return{data:{name:e.data.title}};throw e}catch(t){return{error:t}}},U=/<title[^>]*>\s*(.*)\s*<\/title>/,D=t=>window.__INFINITY__.hasAllUrlPermission?new M.a(async e=>{let o=0;B(t).then(t=>{o+=1,t.error&&2!==o||e(t)}),(async t=>{try{const e=await d.a.get(t,{},{_single:"getUrlInfoFromFE",timeout:3e3,responseType:"text",_responseAll:!0}),o=e.data;if(o&&e.status>=200&&e.status<300){const t=o.indexOf("<title");if(t>0){const e=o.slice(t,t+200),i=U.exec(e),n=null==i?void 0:i[1];if(n)return{data:{name:n}}}}return{error:"error"}}catch(t){return{error:t}}})(t).then(t=>{o+=1,t.error&&2!==o||e(t)})}):new M.a(async e=>{e(await B(t))}),N=(t,e)=>{if(0===e.length)return e;const o=new Map,i=[];return t.forEach((t,e)=>{o.set(t,e)}),e.forEach(t=>{const e=o.get(t);i[e]=t}),i.filter(t=>!!t)},A=t=>new M.a(e=>{const o=()=>{const e=N(t,s),o=N(t,r),i=N(t,a);return e.concat(o,i)},i=t.length;let n=0;const s=[],r=[],a=[];t.forEach(t=>{const c=new Image;c.onload=function(){n+=1;const{width:c,height:l}=this,u=Math.max(c,l),d=Math.min(c,l);u/d<5?d>50&&u>100?s.push(t):d>50||u>100?r.push(t):a.push(t):a.push(t),n===i&&e(o())},c.onerror=()=>{n+=1,n===i&&e(o())},c.src=t}),setTimeout(()=>{e(o())},3e3)}),H=/\.(ico|png|jpg|jpeg|svg|webp)$/,$=async t=>{var e;try{const o=await d.a.get(t,{},{_single:"getUrlIcon",_delay:100,timeout:3e3,responseType:"text",_responseAll:!0}),i=o.data;if(i&&o.status>=200&&o.status<300){const n=(null===(e=o.request)||void 0===e?void 0:e.responseURL)||t;let s=((t,e)=>{const o=[];return e.replace(/<link [^>]*href=['"]([^'"]+)[^>]*/gi,(t,e)=>{o.push(e)}),I()(o).call(o,(e,o)=>{if(o&&H.test(o)){const i=new E.a(o,t);e.push(i.href)}return e},[])})(n,i);if(s.length<6){const t=((t,e)=>{const o=[];return e.replace(/<img [^>]*src=['"]([^'"]+)[^>]*/gi,(t,e)=>{o.push(e)}),I()(o).call(o,(e,o)=>{if(o&&H.test(o)){const i=new E.a(o,t);e.push(i.href)}return e},[])})(n,i);s=s.concat(t)}s.length>4&&(s.length=4);let r=await A(s);return r=Array.from(new Set(r)),r.length>2&&(r.length=2),{data:r}}return{error:""}}catch(t){return{error:t}}},F=async t=>{try{const{host:e}=new E.a(t),o=await d.a.get(u.y+"/icon/get_icon_urls",{host:e});return 0!==o.code?{error:o}:{data:o.data.map(t=>t.url)}}catch(t){return{error:t}}},W=async t=>{try{const{host:e}=new E.a(t);if(!e.includes("."))return{data:[]};const o=await d.a.get(u.y+"/icon/get_logo_list",{host:e,limit:2},{_single:!0,_delay:100});return 0!==o.code?{error:o}:{data:o.data.map(t=>t.src)}}catch(t){return{error:t}}},V=async t=>{var e;let o=u.q?36e5:6e4;t||(o=0);try{if(!y.a.requestFirefoxThrottle("/icon/rt",o,!0))return{error:"request throttle error"};const i=await d.a.post(u.y+"/icon/rt",{version:t||""+Date.now()});return 0===i.code&&y.a.requestFirefoxThrottle("/icon/rt",!0,!0),0===i.code&&i.data?{data:{list:i.data,version:null===(e=i.meta)||void 0===e?void 0:e.version}}:{error:i}}catch(t){return{error:t}}};function z(t){return t?t.textContent:null}function G(t){return new M.a((e,o)=>{const i=new XMLHttpRequest;i.onreadystatechange=function(){var t,n;if(4==i.readyState)if(i.responseXML){const o=i.responseXML;let s=z(o.querySelector("title"));if(s)try{s=/(\w+)@(\w+\.\w+)/.exec(s)[0]}catch(t){}const r=parseInt(z(o.querySelector("fullcount")),10),a=o.querySelectorAll("entry"),c=[];let l=-1;for(let e=0,o=a.length;e<o;e++){const o=a[e],i={id:z(o.querySelector("id")),issued:z(o.querySelector("issued")),title:z(o.querySelector("title")),summary:z(o.querySelector("summary")),link:(t=o.querySelector("link"),n="href",t?t.getAttribute(n):null),authorName:z(o.querySelector("author name")),authorEmail:z(o.querySelector("author email"))};i.issued&&(i.issued=new Date(i.issued).valueOf(),l=Math.max(l,i.issued)),c.push(i)}e({account:s,lastIssuedTime:l,count:r,emails:c})}else o()},i.onerror=o,i.open("GET",function(t){return u.f+"/mail/feed/atom?zx="+encodeURIComponent(t)}(t),!0),i.send(null)})}var K=o(89),J=o.n(K),X=o(9);const Q=async({email:t,password:e,repeatPassword:o,code:i})=>{const n={email:J()(t).call(t),password:f()(e),repeatPassword:f()(o),code:J()(i).call(i)};try{return await d.a.post(u.y+"/user/register",n)}catch(t){return t}},Y=async({email:t,password:e,phone_number:o})=>{const i={email:t?J()(t).call(t):void 0,phone_number:o?J()(o).call(o):void 0,password:f()(e)};try{return await d.a.post(u.y+"/user/login",i)}catch(t){return t}};async function Z(t){const{data:e}=await X.k.read(),o=e.userInfo.uid;try{return await d.a.post(u.y+"/user/update_profile/"+o,t,{_auth:!0})}catch(t){throw new Error(t.message)}}async function tt(){try{return await d.a.get(u.y+"/user/get_user_profile",{},{_auth:!0,_proxy:!0})}catch(t){return t}}async function et(t){const e=new FormData;e.append("file",t);try{const t=await d.a.post(u.y+"/upload/avatar",e,{_auth:!0,headers:{"Content-Type":"multipart/form-data"}});if(0===(null==t?void 0:t.code))return t;throw new Error(i18n("upload_avatar_failure"))}catch(t){throw new Error(t)}}async function ot({originPassword:t,newPassword:e}){const{data:o}=await X.k.read(),i=o.userInfo.uid,{token:n}=o;if(!n)throw new Error(i18n("unknown_mistake"));const s={originPassword:f()(t),newPassword:f()(e)};try{return await d.a.post(u.y+"/user/modify_password/"+i,s,{_auth:!0})}catch(t){return t}}async function it(t){try{const e=await d.a.post(u.y+"/user/forget_password",t);return 0===e.code?{data:e.data}:{error:e}}catch(t){return{error:t}}}async function nt({password:t,repeatPassword:e,email:o,code:i,phone_number:n}){const s={password:f()(t),repeatPassword:f()(e),email:o?J()(o).call(o):void 0,code:J()(i).call(i),phone_number:n?J()(n).call(n):void 0};try{return await d.a.post(u.y+"/user/reset_password",s)}catch(t){return t}}async function st(t){try{const e=await d.a.post(`${u.y}/get_code2?lang=${u.D.lang}`,t,{withCredentials:!0});return 0===e.code?{data:e.data}:{error:e}}catch(t){return{error:t}}}async function rt(t){try{return await d.a.post(`${u.y}/get_register_code2?lang=${u.D.lang}`,t,{withCredentials:!0})}catch(t){return t}}async function at(t){try{return await d.a.post(u.y+"/inspce_code",t)}catch(t){return t}}async function ct(){try{return await d.a.get(u.y+"/check_token",{},{_auth:!0})}catch(t){return t}}async function lt(){const{data:t}=await X.k.read(),e=t.userInfo.uid;try{return await d.a.post(u.y+"/user/delete/"+e,{},{_auth:!0})}catch(t){return t}}const ut=async t=>{try{return await d.a.post(u.y+"/user/login_uid",t,{timeout:1e4})}catch(t){return t}},dt=async t=>{try{return await d.a.post(u.y+"/user/v1_basic_login",t,{timeout:1e4})}catch(t){return t}},ht=async(t,e)=>{try{return await d.a.get(`${u.y}/user/user_hash?uid=${t}&secret=${e}`)}catch(t){return t}},pt=async()=>{try{const t=await d.a.get(u.y+"/login_code/mobile_code",{},{_auth:!0});return 0===t.code?{data:t.data}:{error:t}}catch(t){return{error:t}}},gt=async(t,e)=>{try{const o=await d.a.post(u.y+"/login_code/check",{code:t,type:e},{_auth:!0});return 0===o.code?{data:o.data}:{error:o}}catch(t){return{error:t}}};async function yt(t){try{const e=await d.a.post(u.y+"/phone/send_code",t,{withCredentials:!0});return 0===e.code?{data:e.data}:{error:e}}catch(t){return{error:t}}}async function mt(t){try{const e=await d.a.post(u.y+"/get_email_bind_code",t,{_auth:!0,withCredentials:!0});return 0===e.code?{data:e.data}:{error:e}}catch(t){return{error:t}}}async function ft(t){try{const e=await d.a.post(u.y+"/bind/email",t,{_auth:!0});return 0===e.code?{data:e.data}:{error:e}}catch(t){return{error:t}}}async function bt(t){try{const e=await d.a.post(u.y+"/bind/phone",t,{_auth:!0});return 0===e.code?{data:e.data}:{error:e}}catch(t){return{error:t}}}async function wt(){try{const t=await d.a.post(u.y+"/unbind/email",{},{_auth:!0});return 0===t.code?{data:t.data}:{error:t}}catch(t){return{error:t}}}async function kt(){try{const t=await d.a.post(u.y+"/unbind/phone",{},{_auth:!0});return 0===t.code?{data:t.data}:{error:t}}catch(t){return{error:t}}}async function vt(t,e){try{const o=await d.a.post(u.y+"/phone/verify_code",{phone_number:t,code:e});return 0===o.code?{data:o.data}:{error:o}}catch(t){return{error:t}}}var St;async function Tt(t,e){try{const o=await d.a.post(`${u.y}/bind/${t}`,{access_code:e},{_auth:!0});return 0===o.code?{data:o.data}:{error:o}}catch(t){return{error:t}}}async function _t(t){try{const e=await d.a.post(`${u.y}/unbind/${t}`,{},{_auth:!0});return 0===e.code?{data:e.data}:{error:e}}catch(t){return{error:t}}}async function xt(){try{const t=await(await d.a.get(u.y+"/phone/area_list"));return 0===t.code?{data:t.data}:{error:t}}catch(t){return{error:t}}}async function Lt(t){try{const e=await d.a.post(u.y+"/user/verify_password",{password:f()(t)},{_auth:!0});return 0===e.code?{data:e.data}:{error:e}}catch(t){return{error:t}}}async function Ot(){try{const t=await d.a.get(u.y+"/verify/get_token_img");return 0===t.code?{data:t.data}:{error:t}}catch(t){return{error:t}}}!function(t){t.weibo="weibo",t.facebook="facebook",t.google="google",t.wechat="wechat",t.qq="qq"}(St||(St={}));const jt=async()=>{try{const t=await d.a.get(u.y+"/get_concat_info");if(0===t.code)return{data:t.data};throw t}catch(t){return{error:t}}},Mt=async(t,e)=>{try{const{response:o,stack:i,config:n}=e;let s=o||n;s&&(s=JSON.stringify(s,(t,e)=>{if(e instanceof FormData){const t={};for(const[o,i]of e)t[o]=i;return t}if(e instanceof File){return{lastModified:e.lastModified,name:e.name,size:e.size,type:e.type}}return e}));let{data:r,error:a}=await X.k.read();if(!a&&r){const t=["mobileuid","avatar","refreshToken","secret","gender","name"];r=JSON.stringify(r,(e,o)=>{if(!t.includes(e))return o})}const c=await d.a.post(u.y+"/collect",{type:t,user:r,stack:i,info:s,env:Object.assign({},u.D)});if(0===c.code)return{data:c.data};throw c}catch(t){return{error:t}}},Pt=async t=>{await d.a.get(t,void 0,{_proxy:!0,_proxyIgnoreRes:!0})},It=t=>{const e=JSON.stringify(t),o=(new TextEncoder).encode(e);return new Blob([o],{type:"application/json;charset=utf-8"})},Rt=t=>{const e={};return t.forEach(t=>{const{platform:o}=t;e[o]?e[o].push(t):e[o]=[t]}),e},Et=t=>{const{_id:e,_platform:o="pc"}=t;return{id:e,time:y.a.fmtTime(Number(e)),platform:o}},Ct=async()=>{try{const t=await d.a.get(u.y+"/sync/list",void 0,{_auth:!0,_proxy:!0});if(0!==t.code)return{error:t};const e={};return e.auto=t.meta.auto.map(Et),e.manual=Rt(t.meta.manual.map(Et)),{data:e}}catch(t){return{error:t}}},qt=async(t,e,o="all")=>{try{const i=await d.a.get(u.y+"/sync/download_url",{id:t,type:e,keys:o},{_auth:!0});if(0!==i.code)return{error:i};const n=i.data;let s={};const r=await M.a.all(n.map(e=>d.a.get(e.url+"&timestampid="+("latest"===t?Date.now():t),{},{timeout:18e4})));return n.forEach((t,o)=>{const i=t.fileKey;"manual"===e?s=Object.assign(Object.assign({},s),r[o]):"auto"===e&&(s[i]=r[o])}),{data:s}}catch(t){return Mt("getSyncDetail",t),{error:t}}},Bt=async(t,e="")=>{const o=Object.keys(t).join(",");try{const i=await d.a.get(u.y+"/sync/token",{type:"auto",keys:o},{_auth:!0});if(0!==i.code||!i.data.length)return{error:i};const n=i.data;await M.a.all(n.map(e=>{const{url:o,key:i,token:n,host:s}=e,r=new FormData;return r.append("token",n),r.append("key",o),r.append("file",It(t[i])),d.a.post(s,r,{headers:{"Content-Type":"multipart/form-data"},timeout:18e4})})),localStorage.setItem("pre-sync-id",n[0].timestamp+"");const s=await d.a.post(u.y+"/sync/done",{type:"auto",websocketkeys:e,keys:o,record_time:n[0].timestamp},{_auth:!0});return 0!==s.code?{error:s}:{data:s.meta.map(Et)}}catch(t){return Mt("autoBackup",t),{error:t}}},Ut=async t=>{try{const e=await d.a.get(u.y+"/sync/token",{type:"manual",keys:"data"},{_auth:!0});if(0!==e.code||!e.data.length)return{error:e};const{token:o,url:i,timestamp:n,host:s}=e.data[0],r=new FormData;r.append("token",o),r.append("key",i),r.append("file",It(t)),await d.a.post(s,r,{headers:{"Content-Type":"multipart/form-data"},timeout:18e4});const a=await d.a.post(u.y+"/sync/done",{type:"manual",keys:"data",record_time:n},{_auth:!0});return 0!==a.code?{error:a}:{data:Rt(a.meta.map(Et))}}catch(t){return Mt("manualBackup",t),{error:t}}},Dt=t=>"pro"===t?async function(){try{const{data:{userInfo:t}}=await X.k.read(),{uid:e,secret:o}=t,i=await d.a.get(u.x+"/user/recovery-pro",{uid:e,secret:o},{timeout:2e5});if(i.success)return{data:i.data};throw i}catch(t){return Mt("getProV1Data",t),{error:t}}}():"basic"===t?async function(){try{const t=await d.a.get(u.y+"/sync/recover_basic",{},{_auth:!0,timeout:2e5});return 0!==t.code?{error:t}:{data:t.data}}catch(t){return Mt("getBasicV1Data",t),{error:t}}}():void 0;var Nt=o(275)},263:function(t,e,o){"use strict";o.d(e,"a",(function(){return c})),o.d(e,"b",(function(){return l}));o(11),o(14),o(8),o(41);var i=o(4),n=o(163),s=function(t,e,o,i){var n,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(r=(s<3?n(r):s>3?n(e,o,r):n(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r};const r={},a=new Set;class c{constructor(){this.firstSync=!1,this.syncTabTime=0,this._lockRollback=!1,this.isRollbackFromStorage=!1,this.backupFileKey="",this.backupValueKeys=[],this.rollbackFromStorage=()=>null,this.stopToStorageReaction=()=>{},this.stopAutoBackupReaction=()=>{},this.convertBackupEquals=t=>t}async initSyncStore(t,e,o={},s=20){const a=t.key;if(r[a])throw new Error("storage key 重复");r[a]=this,0!==e.length&&(this.rollbackFromStorage=async()=>{let n=!1;const r=Object.create(null);Object.keys(o).forEach(t=>{e.includes(t)&&(r[t]=o[t])});try{const{data:o,error:i}=await t.read();if(i)throw i;const s=o?Object.keys(o):[];o&&s.forEach(t=>{e.includes(t)&&(r[t]=o[t])}),this.firstSync||o&&!e.some(t=>!s.includes(t))||(n=!0)}catch(t){console.error("storageSync",t)}this.isRollbackFromStorage=!0,this.stopToStorageReaction(),this.stopAutoBackupReaction(),Object(i.i)(()=>{for(const t in r)this[t]=r[t];this.firstSync||(this.firstSync=!0)}),this.restartAutoBackupReaction(),this.stopToStorageReaction=Object(i.h)(()=>{const t={};return e.forEach(e=>{t[e]=Object(i.j)(this[e])}),t},e=>{this.isRollbackFromStorage=!1,t.create(e).then(()=>{Object(i.i)(()=>{this.syncTabTime=Date.now()})})},{equals:i.d.structural,delay:s,fireImmediately:n})},await this.rollbackFromStorage(),Object(i.h)(()=>this.syncTabTime,t=>{t&&n.slave.sendMessage("tabs-sync",a)},{delay:60}))}restartAutoBackupReaction(t=!1){this.stopAutoBackupReaction(),this.stopAutoBackupReaction=Object(i.h)(()=>{const t={};return this.backupValueKeys.forEach(e=>{t[e]=Object(i.j)(this[e])}),t},t=>{(async(t,e)=>{try{const{syncStore:i}=await Promise.all([o.e(6),o.e(7),o.e(30)]).then(o.bind(null,614));i.pushAutoBackupPipe({[t]:e})}catch(t){}})(this.backupFileKey,t).catch()},{fireImmediately:t,equals:(t,e)=>{const o=this.convertBackupEquals(t),n=this.convertBackupEquals(e);return i.d.structural(o,n)},delay:40})}initAutoBackup(t,e){if(a.has(t))throw new Error("file key 重复");a.add(t),0!==e.length&&(this.backupFileKey=t,this.backupValueKeys=[...e])}async getBackupData(){const t={};return this.backupValueKeys.forEach(e=>{t[e]=Object(i.j)(this[e])}),t}}s([i.g],c.prototype,"firstSync",void 0),s([i.g],c.prototype,"syncTabTime",void 0),s([i.b],c.prototype,"initSyncStore",null);const l=t=>{const e=r[t];(null==e?void 0:e._lockRollback)||e.rollbackFromStorage()}},265:function(t,e,o){"use strict";o.d(e,"a",(function(){return u}));o(8),o(11),o(14),o(41);var i=o(0),n=o(491),s=o(36),r=o.n(s),a=o(3);const c=Object(i.F)()?"pc":"mobile";var l=o(23);const u=new class{constructor(){this.ga=null,this.localKey="analytics-status-time",this.gap=432e5,this.getPermission=async()=>{let t=!0;if(i.n)try{const{privacyStore:e}=await Promise.all([o.e(6),o.e(7),o.e(29)]).then(o.bind(null,621));1!==e.collectData&&(t=!1)}catch(e){t=!1}return t},this.trySendStatus=t=>{const e=localStorage.getItem(this.localKey);e?(Date.now()-Number(e)>this.gap||Number(e)>Date.now())&&this.sendStatus(t):this.sendStatus(t)},this.sendPageView=async t=>{if(!await this.getPermission())return;const e=this.ga.getPageviewUrl(t);l.c.sendLog(e)},this.sendEvent=async(t,e=!1)=>{await this.getPermission()&&Object.keys(t).forEach(o=>{const i=t[o];if("object"==typeof i)Object.keys(i).forEach(t=>{const n=i[t],s=this.ga.getEventUrl({category:o,action:t,label:String(n),nonInteraction:e});l.c.sendLog(s)});else{const t=this.ga.getEventUrl({category:o,action:String(i),nonInteraction:e});l.c.sendLog(t)}})},this.sendBaidu=async t=>{await this.getPermission()&&(async(t="")=>{const e=i.D.runtimePlatform,o=c+"-"+e;if(null==t?void 0:t.includes("baidu.com")){const e=new r.a(t).searchParams.get("tn"),n=`https://manage-api.infinitytab.com/analysis-manager/send/60efd763a741942ac60374e1?label=${i.C.baiduLabel}&action=${e}&event=${o}`;i.s?navigator.sendBeacon(n):a.a.post(n,null,{_proxy:!0})}})(t)},this.ga=new n.a({trackingId:i.C.trackingId})}async sendStatus(t){try{this.sendEvent(t,!0),localStorage.setItem(this.localKey,""+Date.now())}catch(t){}}}},268:function(t,e,o){"use strict";o.d(e,"a",(function(){return i}));const i=t=>{const e=n(t),o=s(t,e);return{searchWidth:e.width,searchHeight:e.height,searchMarginTop:e.marginTop,searchMarginBottom:e.marginBottom,searchRatio:e.searchRatio,iconBoxWidth:o.boxWidth,iconBoxHeight:o.boxHeight,iconOneHeight:o.iconOneHeight,iconWidth:o.width,miniIconPadding:o.miniIconPadding,iconRatio:o.iconRatio,iconsMargin:o.iconsMargin}},n=t=>{const{searchScale:e,innerHeight:o,innerWidth:i,miniMode:n,topBookmark:s,topUseful:r,mainRatio:a}=t;let c=0;r&&(c+=36),s&&(c+=36);const l=o-c,u=i-.2*i;let d=i,h=9*d/16;h>l&&(h=l,d=16*h/9);const p=d*(.575-.1818*Math.max(Math.min(720,d-1200),0)/720),g={width:p*e,height:h*(.0963-.0296*Math.max(Math.min(405,h-675),0)/405)*e};g.width>u&&(g.height=u/g.width*g.height,g.width=u);const y={width:g.width*a,height:g.height*a};let m=null;m=n?-.3:-.06;const f=g.width/p*a,b=Math.floor(m*l*f)+"px",w=Math.floor(.775*y.height)+"px";return{width:Math.floor(y.width)+"px",height:Math.floor(y.height)+"px",searchRatio:Number((y.width/625).toFixed(2)),marginTop:b,marginBottom:w,appContentWidth:u,appContentHeight:l,searcherSizeWithRatio:g}},s=(t,e)=>{const{row:o,col:i,rowGap:n,colGap:s,iconScale:r,innerWidth:a,mainRatio:c,fontSize:l}=t;let u=a;u<1200?u=1200:u>1920&&(u=1920);const{appContentHeight:d,appContentWidth:h,searcherSizeWithRatio:p}=e,g=h,y=.8*d-2.451*p.height,m=1+.5*(1920-u)/720,f=g/i,b=y/o,w=Math.min(Math.min(f,b)*r*m,f,b),k=(y-o*w)/o*n/2,v=i*(w+2*((g-i*w)/i*s/2));let S=Math.min(Math.ceil(v*c),a);let T=o*(w+2*k)*c;const _=w*c,x=1.3*Math.max(l*c,12)+.9*_*.08,L=1.2*(25+x);S<i*L&&(S=i*L),T<o*L&&(T=o*L);let O=.9*_-x-1;O<25&&(O=25);const j=.1*a*c;return{width:Math.floor(O)+"px",miniIconPadding:Math.floor(O/7+4)+"px",boxWidth:Math.ceil(S)+"px",boxHeight:Math.floor(T)+"px",iconOneHeight:Math.floor(T/o)+"px",iconRatio:Number((O/106).toFixed(2)),iconsMargin:Math.floor(j)+"px"}}},275:function(t,e,o){"use strict";o.r(e),o.d(e,"uploadFile",(function(){return a}));o(8);var i=o(0),n=o(3);const s=["infinity-notes-img","custom-wallpaper-library"],r={},a=async(t,e,o)=>{let a;try{if(r[o]&&r[o].endTime>Date.now())a=r[o];else{let t=null;if(t=s.includes(o)?await n.a.get(i.y+"/upload/public_private_token",{type:o},{_auth:!0}):await n.a.get(i.y+"/upload/token",{type:o}),0!==t.code||!t.data.token)return{error:t};a=t.data,a.endTime=Date.now()+1e3*(a.expires-600),r[o]=a}const{token:c,prefix:l}=a,u=new FormData;u.append("token",c),u.append("key",l+e),u.append("file",t,e);const{key:d,url:h}=await n.a.post(a.host,u,{timeout:18e4,headers:{"Content-Type":"multipart/form-data"}});return{data:{url:h,key:d}}}catch(t){return{error:t}}}},276:function(t,e,o){"use strict";o.d(e,"a",(function(){return i}));o(11),o(14);class i{constructor(){this._events=new Map}listenTask(t,e){if("function"!=typeof e)return;this._events.has(t)||this._events.set(t,new Set);this._events.get(t).add(e)}execTask(t,e,...o){if(this._events.has(t)){const i=this._events.get(t);for(const t of i)t(e,...o)}}}},386:function(t,e,o){"use strict";o.d(e,"a",(function(){return y}));var i=o(89),n=o.n(i),s=(o(11),o(14),o(8),o(4)),r=o(401),a=o.n(r),c=o(263),l=o(17),u=o(9),d=o(163),h=function(t,e,o,i){var n,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(r=(s<3?n(r):s>3?n(e,o,r):n(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r};const p=[{text:i18n("todo_welcome"),todoId:"todo-id1dtkk87it2iepal6dv4hr2uig0c",time:Date.now(),updatetime:0,done:!1}];class g extends c.a{constructor(){super(...arguments),this.todoList=p,this.currenetState="done",this.listLength=localStorage.getItem("todo-length")||0}toggleState(t){this.currenetState=t}get needNotificationPermission(){return this.todoList.some(t=>!!t.dueDate)}diffRemote(t){const e=t=>{if(null==t?void 0:t.updatetime){const e={updatetime:void 0};return t.done=!!t.done,Object.assign(Object.assign({},t),e)}},o=a()(t.todoList||[],e),i=a()(Object(s.j)(this.todoList),e);return!s.d.structural(o,i)}mergeRemote(t,e){if(t.todoList)if(e)this.todoList=t.todoList;else{const e=this.todoList,o=t.todoList,{result:i}=l.a.mergeArray(e,o,"todoId");this.todoList=i}}edit(t){this.todoList=this.todoList.map(e=>e.todoId===t?Object.assign(Object.assign({},e),{edit:!e.edit}):e)}get hasDoneTodo(){return this.todoList.filter(t=>t.done).length}async addTodo(t){if(!n()(t).call(t).length)return;const e={done:!1,time:+new Date,todoId:l.a.randomId("todo-"),updatetime:await l.a.getTimestamp(),text:t};Object(s.i)(()=>{this.todoList=[e,...this.todoList]})}removeTodo(){this.todoList=this.todoList.filter(t=>!t.done)}deleteTodo(t){this.todoList=this.todoList.filter(e=>e.todoId!==t)}async toggleTodo(t){const e=await l.a.getTimestamp();Object(s.i)(()=>{this.todoList=this.todoList.map(o=>o.todoId===t?Object.assign(Object.assign({},o),{done:!o.done,updatetime:e}):Object.assign({},o))})}async updateTodo(t,e){const o=await l.a.getTimestamp();Object(s.i)(()=>{this.todoList=this.todoList.map(i=>i.todoId===t?Object.assign(Object.assign(Object.assign({},i),e),{updatetime:o,edit:!1}):Object.assign({},i))})}removeTime(t){this.todoList=this.todoList.map(e=>e.todoId===t?Object.assign(Object.assign({},e),{dueDate:"",dueTime:"",dueTimestamp:null}):e)}}h([s.g],g.prototype,"todoList",void 0),h([s.g],g.prototype,"currenetState",void 0),h([s.b],g.prototype,"toggleState",null),h([s.e],g.prototype,"needNotificationPermission",null),h([s.b],g.prototype,"mergeRemote",null),h([s.b],g.prototype,"edit",null),h([s.g],g.prototype,"listLength",void 0),h([s.e],g.prototype,"hasDoneTodo",null),h([s.b],g.prototype,"addTodo",null),h([s.b],g.prototype,"removeTodo",null),h([s.b],g.prototype,"deleteTodo",null),h([s.b],g.prototype,"toggleTodo",null),h([s.b],g.prototype,"updateTodo",null),h([s.b],g.prototype,"removeTime",null);const y=new g;y.initSyncStore(u.j,["todoList","listLength"],{}),y.initAutoBackup("todo",["todoList"]),Object(s.c)(()=>{if(y.firstSync){const t=y.todoList.filter(t=>!t.done).length;Object(s.i)(()=>{y.listLength=t}),localStorage.setItem("todo-length",t+"")}});let m=!1;Object(s.c)(()=>{if(y.firstSync){const t=y.todoList.filter(t=>!t.done&&t.dueTimestamp>Date.now()).map(t=>Object(s.j)(t));if(!m)return void(m=!0);d.slave.postTask("slave:change-todo",t)}}),Object(s.c)(()=>{let t=!1;const{todoList:e}=y;for(let o=0;o<e.length-1;o++){const{done:i}=e[o],n=e[o+1].done;if(i&&!n){t=!0;break}}t&&(Object(s.i)(()=>{const t=e.filter(t=>t.done),o=e.filter(t=>!t.done);y.todoList=[...o,...t]}),t=!1)},{delay:300})},398:function(t,e,o){"use strict";o.r(e);var i=o(6),n=o.n(i),s=(o(11),o(14),o(197)),r=o(482),a=o(1),c=o(4),l=a.b`.i-bubble {
  position: fixed;
  top: 80px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 99999999;
}
.i-bubble.network-error .i-bubble-wrap,
.i-bubble.error .i-bubble-wrap,
.i-bubble.success .i-bubble-wrap {
  padding-left: 30px;
  padding-right: 32px;
}
.i-bubble + .i-bubble-mask {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(255, 255, 255, 0.7);
  z-index: 999999;
  display: none;
  opacity: 0;
  transition: opacity 150ms ease-in 0s;
}
.i-bubble.loading + .i-bubble-mask {
  display: block;
}
.i-bubble.loading.popup + .i-bubble-mask {
  opacity: 1;
}
.i-bubble .i-bubble-wrap {
  margin: 0 auto;
  box-sizing: border-box;
  padding: 12px 20px;
  background-color: #333;
  box-shadow: 0px 2px 20px 0px rgba(0, 0, 0, 0.1);
  border-radius: 4px;
  display: flex;
  flex-flow: row nowrap;
  align-items: center;
  font-size: 14px;
  line-height: 1.4em;
  transition: opacity 0.15s cubic-bezier(0, 0, 0.2, 1) 0ms, transform 0.15s cubic-bezier(0, 0, 0.2, 1) 0ms;
  transform: scale(0.8);
  opacity: 0;
  box-shadow: 0 3px 5px -1px rgba(0, 0, 0, 0.2), 0 6px 10px 0 rgba(0, 0, 0, 0.14), 0 1px 18px 0 rgba(0, 0, 0, 0.12);
  max-width: 600px;
}
.i-bubble.popup .i-bubble-wrap {
  transform: scale(1);
  opacity: 1;
}
@keyframes spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}
.i-bubble .icon {
  width: 18px;
  height: 18px;
  flex-shrink: 0;
  margin-right: 12px;
  display: none;
}
.i-bubble .icon.icon-loading {
  animation: spin 700ms linear infinite;
}
.i-bubble .i-bubble-text {
  color: #e4e4e4;
  display: block;
  box-sizing: border-box;
  flex-grow: 1;
  width: 100%;
  word-break: break-all;
}
.i-bubble .i-bubble-button {
  width: 70px;
  height: 28px;
  color: #4caf50;
  background-color: initial;
  border: none;
  padding: 0;
  cursor: pointer;
  transition: color, background-color 200ms;
  border-radius: 4px;
  outline: none;
  max-width: 180px;
  margin-left: 46px;
  flex-shrink: 0;
  white-space: nowrap;
  text-overflow: ellipsis;
  overflow: hidden;
}
.i-bubble .i-bubble-button:hover {
  background-color: rgba(76, 175, 80, 0.14);
}
`,u=o(17),d=o(27),h=function(t,e,o,i){var n,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(r=(s<3?n(r):s>3?n(e,o,r):n(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r};const p=Object(d.a)("network-error.png",!1),g=Object(d.a)("error.png",!1),y=Object(d.a)("success.png",!1),m=Object(d.a)("loading.png",!1);class f extends s.a{constructor(){super(...arguments),this.popup=!1,this.showButton=!1}static _timeToHideHandler(t){if(t.showButton){const e=t.shadowRoot.querySelector(".i-bubble .i-bubble-button");e.onclick&&(e.onclick=null)}const e=t.shadowRoot.querySelector(".i-bubble > .i-bubble-wrap");let o=!1;const i=()=>{t.onmouseenter=null,t.onmouseleave=null,document.body.contains(t)&&document.body.removeChild(t),o=!0};e.addEventListener("transitionend",i,{once:!0}),e.addEventListener("transitioncancel",i,{once:!0}),setTimeout(()=>{o||i()},150),t.setPopup(!1)}static _setTimerToHide(t,e){this._clearTimerToHide(t),t.hideTimer=setTimeout(()=>this._timeToHideHandler(t),e)}static _clearTimerToHide(t){t.hideTimer&&(clearTimeout(t.hideTimer),t.hideTimer=null)}static _messageMisc(t,e,o){this.setText(t),document.body.appendChild(this),window.customElements.whenDefined("i-bubble").then(()=>(this.offsetWidth,this.setPopup(!0),new n.a(t=>requestAnimationFrame(t)))).then(()=>{o&&o(this)}),e>0&&f._setTimerToHide(this,e)}static message(t,e){const o=document.createElement("i-bubble");o.setType("message"),e=null!=e?e:this.duration,this._messageMisc.call(o,t,e)}static networkError(t,e){const o=document.createElement("i-bubble");o.setType("network-error"),e=null!=e?e:this.duration,this._messageMisc.call(o,t,e)}static success(t,e){const o=document.createElement("i-bubble");o.setType("success"),e=null!=e?e:this.duration,this._messageMisc.call(o,t,e)}static error(t,e){const o=document.createElement("i-bubble");o.setType("error"),e=null!=e?e:this.duration,this._messageMisc.call(o,t,e)}static popupLogin(t){const e=this.popup(i18n("reqeust_login_message"),{showButton:!0,btnValue:i18n("to_login"),type:"message",onBtnClick:null!=t?t:()=>{r.userStore.openModal()}}),o=Date.now();let i=this.duration2;e.onmouseenter=()=>{i=Date.now()-o,f._clearTimerToHide(e)},e.onmouseleave=()=>{f._setTimerToHide(e,i)}}static popupLoading(t){const e=this.popup(i18n("wallpaper_loading"),{duration:0,showButton:!0,btnValue:i18n("cancel"),type:"loading",onBtnClick:t});return()=>setTimeout(()=>this._timeToHideHandler(e),f.waitForReady)}static loading(t){const e=this.popup(t,{type:"loading",duration:0});return()=>setTimeout(()=>this._timeToHideHandler(e),f.waitForReady)}static popup(t,e){const{duration:o=this.duration2,btnValue:i,onBtnClick:n,type:s,showButton:r}=e,a=document.createElement("i-bubble");return a.setType(s),i&&a.setBtnValue(i),r&&a.setShowButton(r),this._messageMisc.call(a,t,o,()=>{if(a.showButton){a.shadowRoot.querySelector(".i-bubble .i-bubble-button").onclick=t=>{n&&n(t),this._timeToHideHandler(a)}}}),a}firstUpdated(){const t="\n      background-size: cover;\n      background-repeat: no-repeat;\n      background-position: center;\n      display: block;\n    ",e=document.createElement("style");e.appendChild(document.createTextNode(`\n      .i-bubble .icon.icon-network-error{\n        background-image: url(${p});${t}\n      }\n      .i-bubble .icon.icon-success{\n        background-image: url(${y});${t}\n      }\n      .i-bubble .icon.icon-error{\n        background-image: url(${g});${t}\n      }\n      .i-bubble .icon.icon-loading{\n        background-image: url(${m});${t}\n      }\n      `)),this.shadowRoot.appendChild(e)}render(){return a.e`
      <section class="i-bubble ${this.type}${this.popup?" popup":""}">
        <section class="i-bubble-wrap">
          <i class="icon icon-${this.type}"></i>
          <span class="i-bubble-text">${this.text}</span>
          <input
            class="i-bubble-button"
            type="button"
            .value=${this.btnValue}
            style="${this.showButton?"":"display: none;"}"
          />
        </section>
      </section>
      <section class="i-bubble-mask" @click=${u.a.stopBubble}></section>
    `}setType(t){this.type=t}setText(t){this.text=t}setBtnValue(t){this.btnValue=t}setPopup(t){this.popup=t}setShowButton(t){this.showButton=t}}f.duration=3e3,f.duration2=5e3,f.waitForReady=1e3/60,f.styles=l,h([c.g],f.prototype,"type",void 0),h([c.g],f.prototype,"text",void 0),h([c.g],f.prototype,"btnValue",void 0),h([c.g],f.prototype,"popup",void 0),h([c.g],f.prototype,"showButton",void 0),h([c.b],f.prototype,"setType",null),h([c.b],f.prototype,"setText",null),h([c.b],f.prototype,"setBtnValue",null),h([c.b],f.prototype,"setPopup",null),h([c.b],f.prototype,"setShowButton",null),window.customElements.define("i-bubble",f);e.default=f},399:function(t,e,o){"use strict";o.d(e,"a",(function(){return i})),o.d(e,"b",(function(){return s}));o(11),o(14);class i{constructor(){this._caches={},this._setCaches=t=>(...e)=>{this._caches[t]=e}}}const n=[],s=t=>new Proxy(t,{set:(t,e,o)=>null===o?(t[e]=o,!0):"function"==typeof t[e]?(console.warn("失败：重复注册"),!0):(t[e]=o,n.includes(e)&&delete t._caches[e],t._caches.hasOwnProperty(e)&&(t[e](...t._caches[e]),delete t._caches[e]),!0),get:(t,e)=>"function"==typeof t[e]?t[e]:t._setCaches(e)})},400:function(t,e,o){"use strict";o.d(e,"a",(function(){return a}));var i=o(6),n=o.n(i),s=(o(8),o(0)),r=o(75);async function a(){if(s.s||s.r){if("granted"!==await new n.a(t=>{!function(){try{Notification.requestPermission().then()}catch(t){return!1}return!0}()?Notification.requestPermission(t):Notification.requestPermission().then(t)}))throw new Error}else await r.a.request(["notifications"])}},482:function(t,e,o){"use strict";o.r(e),o.d(e,"userStore",(function(){return _}));o(8),o(41),o(11),o(14),o(21);var i=o(6),n=o.n(i),s=o(269),r=o.n(s),a=o(99),c=o.n(a),l=o(4),u=o(263),d=o(23),h=o(0),p=o(93),g=o(22),y=o.n(g),m=o(120),f=o(163),b=o(484),w=o(483),k=o(9),v=o(29),S=function(t,e,o,i){var n,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(r=(s<3?n(r):s>3?n(e,o,r):n(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r};class T extends u.a{constructor(){super(),this.isExpired=!1,this.isLogin=!1,this.token="",this.userInfo={},this.refreshToken="",this.mobileloginExpire=0,this.mobileloginUrl="",this.areaCodeList=[],this.thirdList=[{type:d.g.ThirdLoginType.wechat,title:i18n("wechat"),bindStatus:!1,nick_name:""},{type:d.g.ThirdLoginType.qq,title:"QQ",bindStatus:!1,nick_name:""},{type:d.g.ThirdLoginType.google,title:"Google",bindStatus:!1,nick_name:""},{type:d.g.ThirdLoginType.facebook,title:"Facebook",bindStatus:!1,abondon:!0,nick_name:""},{type:d.g.ThirdLoginType.weibo,title:i18n("xin_lang_weibo"),bindStatus:!1,abondon:!0,nick_name:""}],this.userProfilePromise=n.a.resolve(),this.wpColorUpdate=0,this.logining=!1,this.modalOpen=!1,this.removeAccountDisableSec=10,this.removeAccountDisableTimer=null,this.showLoginTipModal=!1,this.profileModal=!1,this.syncListModal=!1,this.isModify=!1,this.openMiniWindow=t=>{const e=Math.floor(window.screenY+200),o=Math.floor(window.screenX+window.innerWidth/3);return window.open(t,"_blank",`top=${e},left=${o},height=600,width=770,menubar=no,toolbar=yes,location=yes,status=no,resizable=no`)},this.binding=!1,this.bindListener=t=>{let e;const o=()=>{e=setTimeout(()=>{t.postMessage({from:"origin_login"},"*"),t.closed?(window.removeEventListener("message",i),this.binding=!1):o()},500)};o();const i=async t=>{try{if(!t.data&&!t.data.key&&"login"!==t.data.key)return;clearTimeout(e),window.removeEventListener("message",i,!1);const{message:o}=t.data;let n;switch(o.type){case d.g.ThirdLoginType.weibo:case d.g.ThirdLoginType.google:case d.g.ThirdLoginType.facebook:case d.g.ThirdLoginType.wechat:case d.g.ThirdLoginType.qq:n=await d.g.bindThird(o.type,o.code)}if(n.error)return void p.message.error(n.error.message);this.bindSuccess("third",n.data),p.message.success(i18n("bind_success"))}catch(t){p.message.error(i18n("network_error"))}finally{this.binding=!1}};window.addEventListener("message",i,!1)},this.countdownTimer=null,this.checkMobileUrlTimer=null,this.isShowLogoutConfirm=!1,this.showConfirmOpt="",this.isShowSecondProfileModal=!1,this.secondProfileModalType=null,this.clearAllData=!1,this.loading=!1,this.URL=h.y}get thirdAccountList(){const t={};return this.userInfo.third_account&&this.userInfo.third_account.forEach(e=>{t[e.platform]=e}),this.thirdList.map(e=>t[e.type]?Object.assign(Object.assign({},e),{bindStatus:!0,nick_name:t[e.type].nick_name}):e)}setWpColorUpdate(t){this.wpColorUpdate=t}closeModal(){this.modalOpen=!1}openModal(){this.modalOpen=!0}toggleLoginTipModal(){this.showLoginTipModal=!this.showLoginTipModal}closeLoginTipModal(){this.showLoginTipModal=!1}closeProfileModal(){this.profileModal=!1}openProfileModal(){this.profileModal=!0,this.openModify()}closeSyncListModal(){this.syncListModal=!1}openSyncListModal(){this.syncListModal=!0}openModify(){this.isModify=!0}async modifyProfile(t){try{const e=await d.g.updateProfile(t);Object(l.i)(()=>{if(e&&0===e.code){const{user:{name:t,gender:o,avatar:i}}=e.data;this.userInfo.name=t,this.userInfo.gender=o,this.userInfo.avatar=i}else p.message.error(i18n("update_data_failure"))})}catch(t){p.message.error(t.message)}}async getUserProfile(){const t=await d.g.getUserProfile();Object(l.i)(()=>{if(t)if(0===t.code&&this.isLogin){const{gender:e,name:o,avatar:i}=t.data;this.userInfo.name=o,this.userInfo.gender=e,this.userInfo.avatar=i,this.userInfo["auto-backup"]=t.data["auto-backup"],this.userInfo["wp-color-update"]=t.data["wp-color-update"],this.userInfo["backup-version-v2"]=t.data["backup-version-v2"],this.userInfo.email=t.data.email,this.userInfo.phone_number=t.data.phone_number,this.userInfo.third_account=t.data.third_account}else 3012===t.code&&(p.message.error(t.message),this.exitAccount())})}async getAreaCodeList(){const{data:t,error:e}=await d.g.getAreaCodeList();e||(null==t?void 0:t.length)&&Object(l.i)(()=>{this.areaCodeList=t})}async updateAvatar(t){try{return await d.g.uploadAvatar(t)}catch(t){p.message.error(i18n("upload_avatar_failure"))}}closeModify(){this.isModify=!1}thirdPartyLogin(t){let e;switch(this.logining=!0,t){case"facebook":e=this.URL+"/login/facebook";break;case"google":e=this.URL+"/login/google";break;case"qq":e=this.URL+"/login/qq";break;case"sina":e=this.URL+"/login/weibo";break;case"wechat":e=this.URL+"/login/wechat"}setTimeout(async()=>{const t=this.openMiniWindow(e);if(this.opener=t,h.n)return;const o=setInterval(()=>{t.postMessage({from:"origin_login"},"*")},300),i=t=>{if(!t.data&&!t.data.key&&"login"!==t.data.key)return;clearInterval(o),window.removeEventListener("message",i,!1);const{message:e}=t.data;this.login3rdSuccess(e)};window.addEventListener("message",i,!1)},300)}get isLastId(){const t=this.userInfo||{},e=t.third_account||[];let o=0;return t.email&&++o,t.phone_number&&++o,o+=e.length,o<=1}thirdPartyBind(t){if(this.binding)return;let e;switch(this.binding=!0,t){case d.g.ThirdLoginType.weibo:case d.g.ThirdLoginType.google:case d.g.ThirdLoginType.facebook:case d.g.ThirdLoginType.wechat:case d.g.ThirdLoginType.qq:e=this.openMiniWindow(`${h.y}/bind/to?type=${t}`),this.bindListener(e)}}async thirdPartyUnbind(t){let e;switch(t){case d.g.ThirdLoginType.weibo:case d.g.ThirdLoginType.google:case d.g.ThirdLoginType.facebook:case d.g.ThirdLoginType.qq:case d.g.ThirdLoginType.wechat:e=await d.g.unbindThird(t)}return e}bindSuccess(t,e){if("email"===t)this.userInfo.email=e;else if("phone"===t)this.userInfo.phone_number=e;else if("third"===t){const t=this.userInfo.third_account||[];t.push(e),this.userInfo.third_account=t}}unbindSuccess(t,e){if("email"===t)this.userInfo.email=null;else if("phone"===t)this.userInfo.phone_number=null;else if("third"===t){const t=this.userInfo.third_account||[],o=t.findIndex(t=>t.platform===e);if(-1===o)return;t.splice(o,1),this.userInfo.third_account=t}}async login(t){const e={};if(e.password=t.password,"email"===t.type)e.email=t.account;else{if("phone"!==t.type)return;e.phone_number=t.account}const o=await d.g.login(e);Object(l.i)(()=>{if(!o||0!==o.code)throw p.message.error(o.message),new Error(o.code);this.loginEmailSuccess(o.data.user),this.setToken(o.data),this.setRefreshToken(o.data.refreshToken)})}async getMobileloginUrl(t=!1){if(t&&(this.mobileloginUrl="",this.mobileloginExpire=0),m.f){const{data:t,error:e}=await d.g.getMobileloginUrl();if(e)return void Object(l.i)(()=>{this.mobileloginExpire=0});Object(l.i)(()=>{this.mobileloginUrl=t.url,this.mobileloginExpire=Math.floor(t.expire/1e3)}),this.checkMobileloginUrl(t.code,t.type),0!==this.mobileloginExpire&&(this.countdownTimer=setInterval(()=>{Object(l.i)(()=>{this.mobileloginExpire-=1}),this.mobileloginExpire<=0&&clearInterval(this.countdownTimer)},1e3))}}async checkMobileloginUrl(t,e,o=5e3){m.f&&this.mobileloginExpire>3&&(clearTimeout(this.checkMobileUrlTimer),this.checkMobileUrlTimer=setTimeout(async()=>{const{data:i}=await d.g.checkMobileloginUrl(t,e);if(i&&i.expired)return clearInterval(this.countdownTimer),void Object(l.i)(()=>{this.mobileloginExpire=0});this.checkMobileloginUrl(t,e,o)},o))}async loginEmailSuccess(t){this.logining=!1,this.closeModal(),this.isLogin=!0,this.userInfo=t,this.isExpired=!1,this.settingLoginSuccess()}setUserData(t){this.logining=!1,this.closeModal(),this.isLogin=t.isLogin,this.userInfo=t,this.isExpired=!1;["token","refreshToken","isLogin"].forEach(t=>delete this.userInfo[t])}async login3rdSuccess(t){if(!t||!Object.keys(t).length)return void this.cancelLogin();const e=t["login-type"];if(["qq","wechat"].includes(e)){const e=await d.g.loginWithUid(t);0===e.code?Object(l.i)(()=>{this.setUserData(t),this.setToken(e.data),this.setRefreshToken(e.data.refreshToken)}):3006===e.code&&p.message.error("获取token失败")}else this.setUserData(t),this.setToken(t),this.setRefreshToken(t.refreshToken);this.settingLoginSuccess()}settingLoginSuccess(){w.b.changeSetting("view","isHideIcp",!0)}cancelLogin(){var t;this.logining=!1,null===(t=this.opener)||void 0===t||t.close()}toggleClear(t){this.clearAllData=t}logout(t){this.isShowLogoutConfirm=!0,this.showConfirmOpt=t,"remove"===t&&(this.removeAccountDisableSec=10,clearInterval(this.removeAccountDisableTimer),this.removeAccountDisableTimer=setInterval(()=>{Object(l.i)(()=>{this.removeAccountDisableSec-=1,0===this.removeAccountDisableSec&&(clearInterval(this.removeAccountDisableTimer),this.removeAccountDisableTimer=null)})},1e3))}showSecondProfileModal(t){this.isShowSecondProfileModal=!0,this.secondProfileModalType=t}closeSecondProfileModal(){this.isShowSecondProfileModal=!1,this.secondProfileModalType=null}async exitAccount(){this.loading=!0,await new n.a(t=>{setTimeout(()=>{this.clearAllData?this.clearAllStore().then(t):t(null)},200)}),Object(l.i)(()=>{this.isLogin=!1,this.userInfo={},this.clearToken()}),this.clearAllData?window.location.reload():(Object(l.i)(()=>this.loading=!1),this.closeLogoutConfirm(),this.closeProfileModal(),h.s&&b.pluginStore.hideLast())}async deleteAccount(){this.loading=!0;const t=await d.g.deleteAccount();Object(l.i)(()=>{t&&0===t.code?this.exitAccount():(3012===t.code&&this.exitAccount(),p.message.error(t.message)),this.loading=!1})}restoreKeysToStorage(t){t.forEach(({data:t,key:e})=>localStorage.setItem(e,t))}async clearAllStore(){this.stopAutoBackupReaction(),this.stopToStorageReaction(),await k.a.deleteAllForLogout();const t=[v.c,v.d];await this._deleteIdb(t),f.slave.sendMessage("tabs-reload")}async _deleteIdb(t){const e=await new n.a(t=>r()(y.a).call(y.a,(e,o)=>t(o)));await n.a.all(t.map(t=>new n.a(o=>{const i=t.split("->");if(1===i.length)return e.includes(t)?void y.a.removeItem(t,o):void o(null);o(null),e.includes(i[0])&&y.a.getItem(i[0],t=>{c()(i).call(i,(t,e,o)=>(o===i.length-1&&Reflect.deleteProperty(t,e),t[e]),t),y.a.setItem(i[0],o)})})))}_clearLocalStorage(t){const e=new Map;t.filter(Boolean).forEach(t=>{const o=t.split("->");if(1===o.length)return void e.set(t,localStorage.getItem(t));const i=JSON.parse(localStorage.getItem(o[0]));o.slice(1).forEach((t,e)=>{const n=0===e?i:i[o[e]];for(const e in n)t!==e&&Reflect.deleteProperty(n,e)}),e.set(o[0],JSON.stringify(i))}),localStorage.clear();for(const t of r()(e).call(e))localStorage.setItem(t,e.get(t))}closeLogoutConfirm(){this.isShowLogoutConfirm=!1}setToken(t){this.token=t.token}setRefreshToken(t){this.refreshToken=t}clearToken(){this.token="",this.refreshToken=""}setOutdated(){this.isExpired=!0,this.isLogin=!1}toggleReLogin(){this.isExpired=!1}getPhoneNumber(){if(this.userInfo.phone_number){const t=this.userInfo.phone_number+"";return`${t.slice(0,3)}****${t.slice(-4)}`}return""}}S([l.g],T.prototype,"isExpired",void 0),S([l.g],T.prototype,"isLogin",void 0),S([l.g],T.prototype,"token",void 0),S([l.g],T.prototype,"userInfo",void 0),S([l.g],T.prototype,"refreshToken",void 0),S([l.g],T.prototype,"mobileloginExpire",void 0),S([l.g],T.prototype,"mobileloginUrl",void 0),S([l.g],T.prototype,"areaCodeList",void 0),S([l.e],T.prototype,"thirdAccountList",null),S([l.g],T.prototype,"wpColorUpdate",void 0),S([l.b],T.prototype,"setWpColorUpdate",null),S([l.g],T.prototype,"opener",void 0),S([l.g],T.prototype,"logining",void 0),S([l.g],T.prototype,"modalOpen",void 0),S([l.g],T.prototype,"removeAccountDisableSec",void 0),S([l.g],T.prototype,"removeAccountDisableTimer",void 0),S([l.b],T.prototype,"closeModal",null),S([l.b],T.prototype,"openModal",null),S([l.g],T.prototype,"showLoginTipModal",void 0),S([l.b],T.prototype,"toggleLoginTipModal",null),S([l.b],T.prototype,"closeLoginTipModal",null),S([l.g],T.prototype,"profileModal",void 0),S([l.g],T.prototype,"syncListModal",void 0),S([l.b],T.prototype,"closeProfileModal",null),S([l.b],T.prototype,"openProfileModal",null),S([l.b],T.prototype,"closeSyncListModal",null),S([l.b],T.prototype,"openSyncListModal",null),S([l.g],T.prototype,"isModify",void 0),S([l.b],T.prototype,"openModify",null),S([l.b],T.prototype,"modifyProfile",null),S([l.b],T.prototype,"getUserProfile",null),S([l.b],T.prototype,"getAreaCodeList",null),S([l.b],T.prototype,"updateAvatar",null),S([l.b],T.prototype,"closeModify",null),S([l.b],T.prototype,"thirdPartyLogin",null),S([l.g],T.prototype,"binding",void 0),S([l.e],T.prototype,"isLastId",null),S([l.b],T.prototype,"thirdPartyBind",null),S([l.b],T.prototype,"thirdPartyUnbind",null),S([l.b],T.prototype,"bindSuccess",null),S([l.b],T.prototype,"unbindSuccess",null),S([l.b],T.prototype,"login",null),S([l.b],T.prototype,"getMobileloginUrl",null),S([l.b],T.prototype,"checkMobileloginUrl",null),S([l.b],T.prototype,"loginEmailSuccess",null),S([l.b],T.prototype,"setUserData",null),S([l.b],T.prototype,"login3rdSuccess",null),S([l.b],T.prototype,"cancelLogin",null),S([l.g],T.prototype,"isShowLogoutConfirm",void 0),S([l.g],T.prototype,"showConfirmOpt",void 0),S([l.g],T.prototype,"isShowSecondProfileModal",void 0),S([l.g],T.prototype,"secondProfileModalType",void 0),S([l.g],T.prototype,"clearAllData",void 0),S([l.b],T.prototype,"toggleClear",null),S([l.b],T.prototype,"logout",null),S([l.b],T.prototype,"showSecondProfileModal",null),S([l.b],T.prototype,"closeSecondProfileModal",null),S([l.g],T.prototype,"loading",void 0),S([l.b],T.prototype,"exitAccount",null),S([l.b],T.prototype,"deleteAccount",null),S([l.b],T.prototype,"clearAllStore",null),S([l.b],T.prototype,"closeLogoutConfirm",null),S([l.b],T.prototype,"setToken",null),S([l.b],T.prototype,"setRefreshToken",null),S([l.b],T.prototype,"clearToken",null),S([l.b],T.prototype,"setOutdated",null),S([l.b],T.prototype,"toggleReLogin",null);const _=new T;Object(l.c)(()=>{_.firstSync&&(_.isLogin?(_.closeModal(),_.toggleReLogin(),_.userProfilePromise=_.getUserProfile()):(_.closeProfileModal(),_.closeSecondProfileModal()))}),_.initSyncStore(k.k,["userInfo","isLogin","token","refreshToken","wpColorUpdate"]),k.i.injectUserStore(_),k.i.injectSendTabsSync(t=>{f.slave.sendMessage("tabs-sync",t)})},483:function(t,e,o){"use strict";o.d(e,"b",(function(){return m})),o.d(e,"a",(function(){return b}));o(11),o(14),o(21),o(8),o(41);var i=o(4),n=o(263),s=o(17),r=o(75),a=o(106),c=o(268),l=o(0),u=o(386),d=o(400),h=o(265),p=o(9),g=function(t,e,o,i){var n,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(r=(s<3?n(r):s>3?n(e,o,r):n(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r};class y extends n.a{constructor(){super(...arguments),this.localSettings={},this.innerWidth=window.innerWidth,this.innerHeight=window.innerHeight,this.iconSpaceWidth=0,this.iconSpaceHeight=0,this.setting=this.init(),this.updatetime=0,this.permission={topUseful:-1,topBookmark:-1,searchSuggest:-1,gmailNotice:-1,gmailCount:-1,todoNotice:-1},this.logs=new Map,this.permissionMapper={topBookmark:[["bookmarks"],["chrome://favicon/"]],topUseful:[["topSites"],["chrome://favicon/"]],searchSuggest:[[],["https://suggestion.baidu.com/","https://google.com/"]],gmailNotice:[["notifications"],["https://mail.google.com/"]],gmailCount:[[],["https://mail.google.com/"]],todoNotice:[["notifications"],[]]},this.showSettingHomeModal=!1,this.webClickName=""}init(t={}){return{notice:Object.assign({},a.b.notice),link:Object.assign({},a.b.link),view:Object.assign({},a.b.view),layout:Object.assign({},a.b.layout),animation:Object.assign({},a.b.animation),icon:Object.assign({},a.b.icon),search:Object.assign({},a.b.search),font:Object.assign({},a.b.font),_v1Setting:t}}get withPermissionTopUseful(){return this.setting.view.topUseful&&1===this.permission.topUseful}get withPermissionTopBookmark(){return this.setting.view.topBookmark&&1===this.permission.topBookmark}get withPermissionSearchSuggest(){return this.setting.search.searchSuggest&&1===this.permission.searchSuggest}get needPermissionList(){const t=[],{view:e,notice:o,search:i}=this.setting,{topUseful:n,topBookmark:s,searchSuggest:r,gmailNotice:a,gmailCount:c,todoNotice:d}=this.permission;return l.m&&i.searchSuggest&&1!==r&&t.push({key:"searchSuggest",title:i18n("permission_serch_suggest_title"),content:i18n("permission_serch_suggest_content")}),l.m&&o.gmail&&1!==a&&t.push({key:"gmailNotice",title:i18n("permission_gmail_notice_title"),content:i18n("permission_gmail_notice_content")}),l.m&&o.gmailNumber&&1!==c&&t.push({key:"gmailCount",title:i18n("permission_gmail_num_title"),content:i18n("permission_gmail_num_content")}),l.s||l.r||!e.topBookmark||1===s||t.push({key:"topBookmark",title:i18n("permission_top_bookmark_title"),content:i18n("permission_top_bookmark_content")}),l.s||l.r||!e.topUseful||1===n||t.push({key:"topUseful",title:i18n("permission_top_useful_title"),content:i18n("permission_top_useful_content")}),u.a.needNotificationPermission&&1!==d&&((l.s||l.r)&&"denied"===Notification.permission||t.push({key:"todoNotice",title:i18n("permission_todo_notice_title"),content:i18n("permission_todo_notice_content")})),t}get sideRatio(){return this.setting.view.scaleSide}reset(){this.setting=this.init(this.setting._v1Setting),this.changeLayoutCb(this.setting.layout.col,this.setting.layout.row)}diffRemote(t){return!i.d.structural(t.setting||{},this.setting)}sendSettingValue(){Object.keys(this.localSettings).length&&(h.a.sendEvent({settingValue:this.localSettings}),this.localSettings={})}async mergeRemote(t){const e=t.setting;if(!t.setting)return;const o=this.setting;this.setting={notice:Object.assign(Object.assign({},o.notice),e.notice),link:Object.assign(Object.assign({},o.link),e.link),view:Object.assign(Object.assign({},o.view),e.view),layout:Object.assign(Object.assign({},o.layout),e.layout),animation:Object.assign(Object.assign({},o.animation),e.animation),icon:Object.assign(Object.assign({},o.icon),e.icon),search:Object.assign(Object.assign({},o.search),e.search),font:Object.assign(Object.assign({},o.font),e.font),_v1Setting:e._v1Setting};const n=await s.a.getTimestamp();Object(i.i)(()=>{this.updatetime=n})}sendSettingLog(t,e){this.logs.has(t)&&clearTimeout(this.logs.get(t)),this.logs.set(t,setTimeout(()=>{h.a.sendEvent({settingAction:{[t]:e}}),this.logs.delete(t)},2e3))}async changeSetting(t,e,o){if(this.setting[t][e]===o)return;this.setting[t][e]=o,"layout"===t&&("custom"===e&&!0===o||"customItem"===e)&&(this.setting.layout.row=this.setting.layout.customItem[0],this.setting.layout.col=this.setting.layout.customItem[1],this.changeLayoutCb(this.setting.layout.col,this.setting.layout.row));let n=`${t}_${e}`,r=o;"layout"!==t||"col"!==e&&"row"!==e||(this.changeLayoutCb(this.setting.layout.col,this.setting.layout.row),n="layout",r=this.setting.layout.row+"*"+this.setting.layout.col),this.sendSettingLog(n,r),this.localSettings[n]=r;const a=await s.a.getTimestamp();Object(i.i)(()=>{this.updatetime=a}),this.changeSettingEffect(t,e,o)}changeLayoutCb(t,e){console.log("col, row",t,e),console.log("changeLayoutCb 未注册")}changeLayout(t){this.changeLayoutCb=t}changeSettingEffect(t,e,o){switch(!0){case"topBookmark"===e:o&&this.requestPermission("topBookmark",!0);break;case"topUseful"===e:o&&this.requestPermission("topUseful",!0);break;case"notice"===t&&"gmail"===e:o&&this.requestPermission("gmailNotice",!0);break;case"notice"===t&&"gmailNumber"===e:o&&this.requestPermission("gmailCount",!0);break;case"searchSuggest"===e:o&&this.requestPermission("searchSuggest",!0)}}async checkPermission(t){if(l.s||l.r){switch(t){case"todoNotice":case"gmailNotice":return void("granted"===Notification.permission?this.permission[t]=1:"default"===Notification.permission?this.permission[t]=-1:this.permission[t]=0)}if(l.s)return}if(1===this.permission[t]){const e=this.permissionMapper[t];try{if(await r.a.has(e[0],e[1]))return}catch(t){console.log(t)}Object(i.i)(()=>{this.permission[t]=-1})}const e=this.permissionMapper[t];try{await r.a.has(e[0],e[1])&&Object(i.i)(()=>{this.permission[t]=1})}catch(t){}}async requestPermission(t,e=!1){if((l.s||l.r)&&["todoNotice","gmailNotice"].includes(t))return await Object(d.a)(),void Object(i.i)(()=>{this.permission.todoNotice=1,this.permission.gmailNotice=1});const o=this.permissionMapper[t];if(e||0!==this.permission[t]&&1!==this.permission[t])try{await r.a.request(o[0],o[1]),Object(i.i)(()=>{this.permission[t]=1}),"gmailNotice"===t&&this.checkPermission("todoNotice")}catch(e){e&&"REJECT"===e.message&&Object(i.i)(()=>{this.permission[t]=0})}}async requestAllPermission(){if(l.s||l.r)return await Object(d.a)(),void Object(i.i)(()=>{this.permission.todoNotice=1,this.permission.gmailNotice=1});const t=[[],[]];this.needPermissionList.forEach(e=>{const o=this.permissionMapper[e.key];t[0].push(...o[0]),o&&t[1].push(...o[1])});try{await r.a.request(t[0],t[1]),Object(i.i)(()=>{this.needPermissionList.forEach(t=>{this.permission[t.key]=1})})}catch(t){Object(i.i)(()=>{this.needPermissionList.forEach(t=>{this.permission[t.key]=0})})}}resetPermission(t){this.permission[t]=-1}setIconSpace(t){this.setting.icon.scale=t.iconScale,this.setting.layout.colGap=t.colGap,this.setting.layout.rowGap=t.rowGap,this.setting.search.scale=t.searchScale}openSearchSuggest(){this.setting.search.searchSuggest?this.requestPermission("searchSuggest",!0):this.setting.search.searchSuggest=!0}get sideScaleRatio(){return this.setting.view.scaleSide}toggleShowSettingHome(t){this.setting.view.isShowHomepageBtn=!t}toggleSettingHomeModal(){this.webClickName="",this.showSettingHomeModal=!this.showSettingHomeModal}closeSettingHomeModal(){this.showSettingHomeModal=!1}setWebClickName(t){this.webClickName=t}}g([i.g],y.prototype,"innerWidth",void 0),g([i.g],y.prototype,"innerHeight",void 0),g([i.g],y.prototype,"iconSpaceWidth",void 0),g([i.g],y.prototype,"iconSpaceHeight",void 0),g([i.g],y.prototype,"setting",void 0),g([i.g],y.prototype,"updatetime",void 0),g([i.g],y.prototype,"permission",void 0),g([i.e],y.prototype,"withPermissionTopUseful",null),g([i.e],y.prototype,"withPermissionTopBookmark",null),g([i.e],y.prototype,"withPermissionSearchSuggest",null),g([i.e],y.prototype,"needPermissionList",null),g([i.e],y.prototype,"sideRatio",null),g([i.b],y.prototype,"reset",null),g([i.b],y.prototype,"mergeRemote",null),g([i.b],y.prototype,"changeSetting",null),g([i.b],y.prototype,"checkPermission",null),g([i.b],y.prototype,"requestPermission",null),g([i.b],y.prototype,"requestAllPermission",null),g([i.b],y.prototype,"resetPermission",null),g([i.b],y.prototype,"setIconSpace",null),g([i.b],y.prototype,"openSearchSuggest",null),g([i.e],y.prototype,"sideScaleRatio",null),g([i.b],y.prototype,"toggleShowSettingHome",null),g([i.g],y.prototype,"showSettingHomeModal",void 0),g([i.b],y.prototype,"toggleSettingHomeModal",null),g([i.b],y.prototype,"closeSettingHomeModal",null),g([i.g],y.prototype,"webClickName",void 0),g([i.b],y.prototype,"setWebClickName",null);const m=new y;m.initSyncStore(p.g,["setting","permission","updatetime"],a.b),m.initAutoBackup("setting",["setting"]),Object(i.c)(()=>{m.firstSync&&m.setting.view.topBookmark&&m.checkPermission("topBookmark")},{delay:50}),Object(i.c)(()=>{m.firstSync&&m.setting.view.topUseful&&m.checkPermission("topUseful")},{delay:50}),Object(i.c)(()=>{m.firstSync&&m.setting.notice.gmail&&m.checkPermission("gmailNotice")},{delay:50}),Object(i.c)(()=>{u.a.firstSync&&u.a.needNotificationPermission&&m.checkPermission("todoNotice")},{delay:50}),Object(i.c)(()=>{m.firstSync&&m.setting.notice.gmailNumber&&m.checkPermission("gmailCount")},{delay:50}),Object(i.c)(()=>{m.firstSync&&m.setting.search.searchSuggest&&m.checkPermission("searchSuggest")},{delay:50}),Object(i.c)(()=>{m.firstSync&&1===m.permission.gmailNotice&&s.a.send({key:"bg-notice-gmail-permission",data:!0})}),Object(i.c)(()=>{if(m.firstSync){const{gmail:t,gmailVoice:e,gmailNumber:o}=m.setting.notice,{gmailCount:i,gmailNotice:n}=m.permission;s.a.send({key:"bg-notice-gmail-updated",data:{gmail:t&&1===n,gmailVoice:e,gmailNumber:o&&(1===n||1===i)}})}},{delay:100}),Object(i.c)(()=>{if(m.firstSync){const t={"--side-ratio":m.sideRatio,"--main-ratio":m.setting.view.scaleMain,"--icon-radius":Math.round(100*m.setting.icon.radius)+"%","--icon-font-color":m.setting.font.color,"--icon-font-size":Math.ceil(Math.max(m.setting.font.size*m.setting.view.scaleMain,12))+"px","--icon-opacity":m.setting.icon.opacity,"--icon-visible":m.setting.icon.isHideIconName?"hidden":"visible","--search-radius":""+m.setting.search.radius,"--search-opacity":m.setting.search.opacity};s.a.setStyle(t)}},{delay:50}),Object(i.c)(()=>{if(m.firstSync){let t=0,e=20;m.withPermissionTopBookmark&&(t+=36),m.withPermissionTopUseful&&(e+=26);const o={"--top-bar-height":t+"px","--settings-icon-top-offset":e+"px"};s.a.setStyle(o)}});const f=t=>{const e={"--search-height":t.searchHeight,"--search-width":t.searchWidth,"--search-margin-top":t.searchMarginTop,"--search-margin-bottom":t.searchMarginBottom,"--search-ratio":t.searchRatio,"--icon-box-width":t.iconBoxWidth,"--icon-box-height":t.iconBoxHeight,"--icon-one-height":t.iconOneHeight,"--icon-width":t.iconWidth,"--mini-icon-padding":t.miniIconPadding,"--icon-ratio":t.iconRatio,"--icon-row":m.setting.layout.row,"--icon-col":m.setting.layout.col,"--main-icons-margin":t.iconsMargin};s.a.setStyle(e)},b=(t=!0)=>{const e={row:m.setting.layout.row,col:m.setting.layout.col,rowGap:m.setting.layout.rowGap,colGap:m.setting.layout.colGap,iconScale:m.setting.icon.scale,searchScale:m.setting.search.scale,innerHeight:innerHeight,innerWidth:innerWidth,miniMode:m.setting.icon.miniMode,fontSize:m.setting.font.size,topUseful:m.withPermissionTopUseful,topBookmark:m.withPermissionTopBookmark,mainRatio:m.setting.view.scaleMain};if(t)requestIdleCallback(()=>{const t=Object(c.a)(e);f(t)});else{const t=Object(c.a)(e);f(t)}};Object(i.c)(()=>{m.firstSync&&b(!1)},{delay:40}),window.addEventListener("resize",s.a.throttle(()=>{b(!1)},56))},484:function(t,e,o){"use strict";o.r(e),o.d(e,"pluginStore",(function(){return u}));o(11),o(14),o(8);var i=o(4),n=o(75),s=o(399);class r extends s.a{opened(t){}}const a=Object(s.b)(new r);var c=function(t,e,o,i){var n,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(r=(s<3?n(r):s>3?n(e,o,r):n(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r};class l{constructor(){this.pluginsMap={"infinity://weather":"side-weather","infinity://todos":"side-todos","infinity://notes":"side-notes","infinity://history":"side-history","infinity://bookmarks":"side-bookmarks","infinity://extension":"side-extension","infinity://chrome-apps":"chrome-apps","infinity://wallpaper":"wallpaper","infinity://settings":"side-profile",search:"side-search",profile:"side-profile",editIcon:"side-editicon","side-tutorial":"side-tutorial"},this.pluginsTags={"side-weather":!1,"side-todos":!1,"side-notes":!1,"side-history":!1,"side-bookmarks":!1,"side-extension":!1,"chrome-apps":!1,"side-profile":!1,"side-search":!1,"side-editicon":!1,"side-tutorial":!1,wallpaper:!1},this.pluginViews=[],this.focusRepair=!1,Object(i.h)(()=>this.pluginViews.map(t=>t),([t])=>{a.opened(t)})}initDom(t){this.pluginsTags[t]=!0}async show(t){if(this.pluginViews.includes(t))return;const e=this.pluginsMap[t];if(!1===this.pluginsTags[e])try{await this.requestPermission(e),Object(i.i)(()=>{this.pluginsTags[e]=!0,this.pluginViews.push(t)})}catch(t){}else this.pluginViews.push(t)}async showRepair(){this.focusRepair=!0,this.show("profile"),localStorage.setItem("user-checkout-old-data","true")}blurRepair(){this.focusRepair=!1}requestPermission(t){switch(t){case"side-bookmarks":return n.a.request(["bookmarks"],["chrome://favicon/"]);case"side-extension":case"chrome-apps":return n.a.request(["management"]);case"side-history":return n.a.request(["history"],["chrome://favicon/"])}}hideLast(){const t=this.pluginViews.pop();return 0===this.pluginViews.length&&document.getElementsByTagName("newtab-main")[0].shadowRoot.querySelector(".swiper-content").style.setProperty("transform","none"),t}}c([i.g],l.prototype,"pluginsTags",void 0),c([i.b],l.prototype,"initDom",null),c([i.g],l.prototype,"pluginViews",void 0),c([i.g],l.prototype,"focusRepair",void 0),c([i.b],l.prototype,"show",null),c([i.b],l.prototype,"showRepair",null),c([i.b],l.prototype,"blurRepair",null),c([i.b],l.prototype,"hideLast",null);const u=new l},487:function(t,e,o){t.exports=o.p+"images/error.f782e7c.png"},488:function(t,e,o){t.exports=o.p+"images/remind.896ff6f.png"},93:function(t,e,o){"use strict";o.r(e),o.d(e,"iMessage",(function(){return d})),o.d(e,"message",(function(){return h}));o(11),o(14);var i=o(398),n=o(1),s=o(385),r=o(487),a=o.n(r),c=o(488),l=o.n(c),u=function(t,e,o,i){var n,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(r=(s<3?n(r):s>3?n(e,o,r):n(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r};let d=class extends n.a{constructor(){super(...arguments),this.content="",this.type="error"}render(){const t={"infinity-message":!0,"position-top":"top"===this.type};return n.e`
      <div class=${Object(s.a)(t)}>
        ${this.renderImg()}
        <span>${this.content}</span>
      </div>
    `}renderImg(){return"error"===this.type?n.e`<img .src=${a.a} />`:"warn"===this.type?n.e`<img .src=${l.a} />`:void 0}};d.styles=n.b`
    :host {
      box-sizing: border-box;
      display: flex;
      position: fixed;
      min-width: 330px;
      padding: 0 20px;
      height: 60px;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 255, 255, 1);
      box-shadow: 0px 6px 48px 0px rgba(0, 0, 0, 0.24);
      border-radius: 6px;
      z-index: 99999999999;
    }
    :host([type='top']) {
      width: 100%;
      margin: 0;
      left: 0;
      top: var(--top-bar-height);
      height: auto;
      padding: 5px;
      border-radius: 0;
      background: rgba(95, 92, 92, 0.6);
      color: #fff;
      transform: none;
      transition: all 300ms;
      opacity: 0;
      pointer-events: none;
    }
    :host(.anim[type='top']) {
      opacity: 1;
    }

    .infinity-message {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
    }
    img {
      width: 20px;
      height: 20px;
      margin-right: 8px;
    }
  `,u([Object(n.g)({type:String})],d.prototype,"content",void 0),u([Object(n.g)({type:String})],d.prototype,"type",void 0),d=u([Object(n.c)("i-message")],d);const h={newInstance:function(t,e=2,o,i){let n;if(document.querySelector("i-message"))return void clearInterval(n);const s=document.createElement("i-message");return s.setAttribute("content",t),s.setAttribute("type",o),document.body.appendChild(s),0!==e&&(n=setTimeout(()=>{document.body.removeChild(s),i&&i()},1e3*e)),s},error:function(t,e,o){i.default.error(t,e),o&&setTimeout(o,e)},success:function(t,e,o){i.default.success(t,e),o&&setTimeout(o,e)},top:function(t,e,o){const i=this.newInstance(t,e,"top",o);setTimeout(()=>null==i?void 0:i.classList.add("anim"))},warn:function(t,e,o){this.newInstance(t,e,"warn",o)}}}}]);