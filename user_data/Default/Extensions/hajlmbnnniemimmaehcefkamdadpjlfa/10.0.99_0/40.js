(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{163:function(e,t,s){"use strict";s.r(t),s.d(t,"slave",(function(){return c}));s(8),s(11),s(14),s(41);var a=s(6),n=s.n(a),i=s(276),r=s(59);const c=new class{constructor(){if(this.channel=null,this.initResolve=[],this.initReject=[],this.messageScheduler=new i.a,this.initChannel=()=>{"serviceworker"===r.b?this.initServiceworker():"background"===r.b&&this.initBackground()},this.awaitChannel=()=>new n.a(async(e,t)=>{"serviceworker"===r.b?this.channel?(await this.channel.active,await this.channel.controlling,e(null)):(this.initResolve.push(e),this.initReject.push(t)):"background"===r.b&&e(null)}),this.initServiceworker=async()=>{try{const{createWorkBox:e}=await s.e(11).then(s.bind(null,615)),t=await e();if(!t)return;t.addEventListener("message",e=>{const{type:t,payload:s={}}=e.data;"master:bordcast-message"===t&&this.messageScheduler.execTask(s.type,s.payload)}),await t.active,await t.controlling,this.channel=t,this.initResolve.forEach(e=>{e()}),this.channel.postTask=this.channel.messageSW}catch(e){console.log("slave初始化错误：",e),this.initReject.forEach(e=>{e()})}},this.initBackground=()=>{this.channel={postTask:e=>new n.a((t,s)=>{chrome.runtime.sendMessage(e,e=>{chrome.runtime.lastError&&s(chrome.runtime.lastError),t(e)})})},chrome.runtime.onMessage.addListener(({type:e,payload:t,ignoreId:s})=>{"master:bordcast-message"===e?chrome.tabs.getCurrent(e=>{s!==e.id&&this.messageScheduler.execTask(t.type,t.payload)}):"slave:bordcast-message"===e&&this.messageScheduler.execTask(t.data.type,t.data.payload)})},r.a)throw new Error("it's not page");this.initChannel()}postTask(e,t,s){return new n.a(async(a,n)=>{let i=!1;await this.awaitChannel();const c=Object.assign(Object.assign(Object.assign({},r.d),{taskId:Object(r.c)()}),s);c.timeout&&setTimeout(()=>{i||a({error:"timeout"})},c.timeout);try{const s=await this.channel.postTask({type:e,payload:Object.assign({data:t},c)});i=!0,a(s)}catch(e){a({error:e})}})}listenMessage(e,t){this.messageScheduler.listenTask(e,t)}sendMessage(e,t=""){this.postTask("slave:bordcast-message",{type:e,payload:t})}}}}]);