(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{387:function(t,e,i){"use strict";i.d(e,"a",(function(){return c})),i.d(e,"d",(function(){return l})),i.d(e,"b",(function(){return d})),i.d(e,"c",(function(){return u}));var s=i(6),o=i.n(s),n=(i(8),i(11),i(14),i(0)),r=i(162),a=i(119);function c(t){let e=0;switch(t){case"per-hour":e=n.q?36e5:2e4;break;case"twelve-hour":e=432e5;break;case"one-day":e=864e5}return e}async function l(t){let e;var i;return e="string"==typeof t?await(i=t,fetch(i).then(t=>t.blob())):t,await new o.a((t,i)=>{const s=new FileReader;s.readAsDataURL(e),s.onload=()=>{t(s.result)},s.onerror=i})}async function d(){const t=await Object(a.getBingWallpaper)();if(t.error)throw t.error;const[e]=Object(r.b)([t.data]);return e}async function u(){const t=await Object(a.getCustomColor)();if(!t.error)return t.data.map(t=>(t.type="color",t));console.warn(t.error)}},614:function(t,e,i){"use strict";i.r(e),i.d(e,"syncStore",(function(){return W}));var s=i(6),o=i.n(s),n=i(99),r=i.n(n),a=(i(11),i(14),i(8),i(41),i(21),i(4)),c=i(23),l=i(263),d=i(625),u=i(483),h=i(626),p=i(622),y=i(386),g=i(627),b=i(482),m=i(623),f=i(1),w=i(197),v=f.b`.container {
  width: 410px;
  box-sizing: border-box;
  padding: 40px 40px 34px 40px;
  background: #ffffff;
  border-radius: 6px;
}
.header {
  text-align: center;
  line-height: 30px;
  height: 28px;
  font-size: 20px;
  font-weight: 500;
  color: #333333;
  line-height: 28px;
}
.main {
  margin: 24px auto 40px;
}
.tips {
  margin-bottom: 30px;
  font-size: 14px;
  font-weight: 400;
  color: #656565;
  line-height: 20px;
}
.checkbox {
  display: flex;
  align-items: center;
  position: relative;
  margin-bottom: 20px;
  font-size: 14px;
  font-weight: 400;
  color: #333333;
  cursor: pointer;
}
.checkbox .input-box {
  display: flex;
  align-items: center;
  position: relative;
}
.checkbox label {
  box-sizing: border-box;
  position: absolute;
  top: 0;
  left: 0;
  width: 16px;
  height: 16px;
  border: 2px solid #333;
  border-radius: 8px;
  cursor: pointer;
}
.checkbox label::after {
  content: '';
  width: 9px;
  height: 5px;
  position: absolute;
  top: 1px;
  left: 1px;
  border: 2px solid #333;
  border-top: none;
  border-right: none;
  background: transparent;
  opacity: 0;
  transform: rotate(-45deg);
}
.checkbox input {
  visibility: hidden;
}
.checkbox input:checked + label::after {
  opacity: 1;
}
.checkbox:last-of-type {
  margin-bottom: 0;
}
.btn {
  width: 330px;
  height: 52px;
}
.footer-import {
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.btn-import {
  width: 155px;
  height: 52px;
}
`,S=function(t,e,i,s){var o,n=arguments.length,r=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(r=(n<3?o(r):n>3?o(e,i,r):o(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};let k=class extends w.a{constructor(){super(...arguments),this.onChecked=t=>{},this.show=!1,this.checked=0,this.handleCheck=t=>{this.show=!1,"function"==typeof this.onChecked&&this.onChecked(t),this.checked=0,this.onChecked=()=>{}}}static create(t){const e=document.body.querySelector("#modal-first-sync");if(e){if(!this.instance){const t=document.createElement("modal-first-sync");e.appendChild(t),this.instance=t}return this.instance.show=!0,this.instance.onChecked=t,this.instance}}static hide(){this.instance&&this.instance.show&&this.instance.handleCheck(null)}firstUpdated(){}checkOne(t){this.checked=t}updated(){this.radios[this.checked].checked=!0}render(){return f.e`<infinito-modal style="--modal-padding:0;" .closeable="${!1}" .open=${this.show}>
      <div slot="body">
        <div class="container">
          <div class="header">${i18n("choose_sync_type")}</div>
          <div class="main">
            <div class="tips">${i18n("sync_type_tips")}</div>
            <div class="checkbox-box">
              <div class="checkbox" @click="${()=>this.checkOne(0)}">
                <div class="input-box">
                  <input name="first_sync" type="radio" value="0" id="first_sync_0" />
                  <label for="first_sync_0"></label>
                </div>
                <span>${i18n("merge_cloud_local")}</span>
              </div>
              <div class="checkbox" @click="${()=>this.checkOne(1)}">
                <div class="input-box">
                  <input name="first_sync" type="radio" value="1" id="first_sync_1" />
                  <label for="first_sync_1"></label>
                </div>
                <span>${i18n("use_local")}</span>
              </div>
              <div class="checkbox" @click="${()=>this.checkOne(2)}">
                <div class="input-box">
                  <input name="first_sync" type="radio" value="2" id="first_sync_2" />
                  <label for="first_sync_2"></label>
                </div>
                <span>${i18n("use_cloud")}</span>
              </div>
            </div>
          </div>
          <div class="footer">
            <infinito-button
              primary
              class="btn"
              @click="${()=>{this.handleCheck(this.checked)}}"
              >${i18n("confirm")}</infinito-button
            >
          </div>
        </div>
      </div>
    </infinito-modal> `}};k.styles=v,k.instance=null,S([Object(f.g)()],k.prototype,"onChecked",void 0),S([Object(f.g)({type:Boolean})],k.prototype,"show",void 0),S([Object(f.g)({type:Number})],k.prototype,"checked",void 0),S([Object(f.i)('[name="first_sync"]')],k.prototype,"radios",void 0),k=S([Object(f.c)("modal-first-sync")],k);var O=function(t,e,i,s){var o,n=arguments.length,r=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(r=(n<3?o(r):n>3?o(e,i,r):o(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};let I=class extends w.a{constructor(){super(...arguments),this.onChecked=t=>{},this.show=!1,this.checked=0,this.handleCheck=t=>{this.show=!1,"function"==typeof this.onChecked&&this.onChecked(t),this.checked=0,this.onChecked=()=>{}}}static create(t){const e=document.body.querySelector("#modal-import-type");if(e){if(!this.instance){const t=document.createElement("modal-import-type");e.appendChild(t),this.instance=t}return this.instance.show=!0,this.instance.onChecked=t,this.instance}}static hide(){this.instance&&this.instance.show&&this.instance.handleCheck(null)}firstUpdated(){}checkOne(t){this.checked=t}updated(){this.radios[this.checked].checked=!0}render(){return f.e`<infinito-modal style="--modal-padding:0;" .closeable="${!1}" .open=${this.show}>
      <div slot="body">
        <div class="container">
          <div class="header">${i18n("import_select_tile")}</div>
          <div class="main">
            <div class="tips">${i18n("inportdata_desc")}</div>
            <div class="checkbox-box">
              <div class="checkbox" @click="${()=>this.checkOne(0)}">
                <div class="input-box">
                  <input name="first_sync" type="radio" value="0" id="first_sync_0" />
                  <label for="first_sync_0"></label>
                </div>
                <span>${i18n("merge_data")}</span>
              </div>
              <div class="checkbox" @click="${()=>this.checkOne(1)}">
                <div class="input-box">
                  <input name="first_sync" type="radio" value="1" id="first_sync_1" />
                  <label for="first_sync_1"></label>
                </div>
                <span>${i18n("overwrite_data")}</span>
              </div>
            </div>
          </div>
          <div class="footer-import">
            <infinito-button
              class="btn-import"
              @click="${()=>{this.handleCheck(null)}}"
              >${i18n("cancel")}</infinito-button
            >
            <infinito-button
              primary
              class="btn-import"
              @click="${()=>{this.handleCheck(this.checked)}}"
              >${i18n("confirm")}</infinito-button
            >
          </div>
        </div>
      </div>
    </infinito-modal> `}};I.styles=v,I.instance=null,O([Object(f.g)()],I.prototype,"onChecked",void 0),O([Object(f.g)({type:Boolean})],I.prototype,"show",void 0),O([Object(f.g)({type:Number})],I.prototype,"checked",void 0),O([Object(f.i)('[name="first_sync"]')],I.prototype,"radios",void 0),I=O([Object(f.c)("modal-import-type")],I);var R=i(163),C=i(0),j=i(387),_=i(265),E=i(9),x=function(t,e,i,s){var o,n=arguments.length,r=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(r=(n<3?o(r):n>3?o(e,i,r):o(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};const L=[d.a,u.b,p.a,h.a,y.a,g.a,m.weatherStore];class U extends l.a{constructor(){super(...arguments),this.timmer=null,this.downloading=!1,this.backuping=!1,this.isBackup=!1,this.isOpenSync=!0,this.syncId="",this.lastSyncTime=0,this.syncSucsess=!1,this.syncFail=!1,this.syncFailMsg="",this.autosSyncList=[],this.waitMergeData=null,this.waitMergeId=null,this.manualSyncList={},this.isRecovered=!1,this.recoverErrorTimes=0,this.master=!1,this.prerender=[],this.autoBackupPipe={data:{},websocketKeys:[],timestamp:0},this.getAllBackupData=async()=>{const t={};return await o.a.all(L.map(async e=>{const i=await e.getBackupData();t[e.backupFileKey]=i})),t},this.getAutoLatest=async(t="all")=>{const e=localStorage.getItem("lock-auto-recover");if(e&&Date.now()-Number(e)<3e3)return;if(localStorage.setItem("lock-auto-recover",""+Date.now()),await this.getSyncList(),0===this.autosSyncList.length){const t=b.userStore.userInfo["backup-version-v2"];if(b.userStore.userInfo["auto-backup"]&&!t){const t=b.userStore.userInfo.email?"basic":"pro";await this.getV1RemoteData(t)}else this.tiggerBackup();return}const i=this.autosSyncList[0];if((null==i?void 0:i.id)===this.syncId||this.waitMergeId===(null==i?void 0:i.id))return;const s=localStorage.getItem("pre-sync-id");s&&(null==i?void 0:i.id)===s||(await this.getDetail(i.id,"auto",t,!1,!0),localStorage.removeItem("lock-auto-recover"))},this.changeSyncStatus=t=>{this.master=!1,this.downloading=t.downloading,this.backuping=t.backuping,this.isBackup=t.isBackup,this.syncFail=t.syncFail,this.syncFailMsg=t.syncFailMsg,this.syncSucsess=t.syncSucsess,(this.syncSucsess||this.syncFail)&&this.syncEnd()}}get autoSyncing(){return this.downloading||this.backuping}async changeSyncSwitch(t){this.isOpenSync=t}async autoBackup(t,e=""){const i=await this.toSync(!0,t,e);return i.error||Object(a.i)(()=>{this.autosSyncList=i.data}),i}async manualBackup(){const{default:t}=await Promise.resolve().then(i.bind(null,398)),e=t.loading(i18n("backing_up")),{error:s,data:o}=await this.toSync();e(),s?t.error(i18n("backup_failed")):Object(a.i)(()=>{this.manualSyncList=o})}async toSync(t=!1,e={},i=""){var s,n;let r;if(this.master=!0,t)this.isBackup=!0,this.backuping=!0,r=await c.e.autoBackup(e,i);else{const t={};await o.a.all(L.map(async e=>{const i=await e.getBackupData();t[e.backupFileKey]=i})),r=await c.e.manualBackup(t)}const{error:a,data:l=[]}=r;return t&&(a||R.slave.postTask("slave:sync-to-server",i),a?this.backupEnd(a.message||"auto-backup error",null===(s=l[0])||void 0===s?void 0:s.id):this.backupEnd(null,null===(n=l[0])||void 0===n?void 0:n.id)),r}backupEnd(t,e=""){Object(a.i)(()=>{this.master=!0,this.backuping=!1,t?this.syncFail=!0:(this.syncSucsess=!0,e&&(this.syncId=e,this.lastSyncTime=Date.now()))}),this.syncEnd()}downloadEnd(t,e=""){Object(a.i)(()=>{this.master=!0,this.downloading=!1,this.backuping=!1,t?this.syncFail=!0:(this.syncSucsess=!0,e&&(this.syncId=e,this.lastSyncTime=Date.now()))}),this.syncEnd()}syncEnd(){clearTimeout(this.timmer),this.timmer=setTimeout(()=>{Object(a.i)(()=>{this.syncFail=!1,this.syncFailMsg="",this.syncSucsess=!1,this.isBackup=!1})},3e3)}async getSyncList(){const{data:t,error:e}=await c.e.getSyncList();if(e)throw e;Object(a.i)(()=>{this.autosSyncList=t.auto,this.manualSyncList=t.manual})}async getDetail(t,e,s="all",o=!1,n=!1){let r,a;if(this.master=!0,o){const{default:t}=await Promise.resolve().then(i.bind(null,398));r=t,a=r.loading(i18n("syncing"))}else this.downloading=!0,this.isBackup=!1;const{data:l,error:d}=await c.e.getSyncDetail(n?"latest":t,e,s);o&&(null==a||a()),d?o?null==r||r.error(i18n("sync_fail")):this.downloadEnd(d.message||"download error"):(await this.useRemote(l,o),this.downloadEnd(null,t),this.tiggerBackup())}tiggerBackup(){var t;this.changeRecoveredStatus(!0),(null===(t=this.autoBackupPipe.websocketKeys)||void 0===t?void 0:t.length)&&(this.autoBackupPipe.timestamp=Date.now())}async getV1RemoteData(t,e=!1){let s,o;if(this.master=!0,e){const{default:t}=await Promise.resolve().then(i.bind(null,398));s=t,o=s.loading(i18n("syncing"))}else this.downloading=!0,this.isBackup=!1;const{error:n,data:r}=await c.e.getV2DataFromV1(t);e&&(null==o||o()),n?(e?null==s||s.error(i18n("sync_fail")):this.downloadEnd(n.message||"download v1 error"),Object(a.i)(()=>{this.recoverErrorTimes+=1})):(this.downloadEnd(null),await this.useRemote(r,e,!0),this.tiggerBackup())}changeRecoveredStatus(t){this.isRecovered=t}autoRunGetAutoLatest(){setTimeout(()=>{this.getAutoLatest()},0)}showModalAndCheckType(t=!1){return new o.a((e,i)=>{var s;if(t&&k.hide(),null===(s=k.instance)||void 0===s?void 0:s.show)return void e(null);const n=Object(a.j)(this.waitMergeData);k.create(async s=>{this.mergeType=s,this.diffColorItems();try{localStorage.setItem("restoring","1"),await o.a.all(L.map(async t=>{if(n&&n[t.backupFileKey])if(1===s)t.restartAutoBackupReaction(!0);else if(2===s)try{await t.mergeRemote(n[t.backupFileKey],!0),"site"===t.backupFileKey&&d.a.setRedirectVersion("")}catch(t){}else{if(0!==s)throw new Error("not check");try{await t.mergeRemote(n[t.backupFileKey],!1),"site"===t.backupFileKey&&d.a.setRedirectVersion("")}catch(t){}t.restartAutoBackupReaction(!0)}})),this.downloadEnd(null,this.waitMergeId),this.tiggerBackup(),Object(a.i)(()=>{this.waitMergeData=null,this.waitMergeId=null})}catch(e){t&&i(e)}localStorage.removeItem("restoring"),e(null)})})}useLocalData(t){L.map(async e=>{if(null==t?void 0:t[e.backupFileKey])try{await e.mergeRemote(t[e.backupFileKey],!0)}catch(t){console.error("Store ~ syncStores.map ~ error",t)}})}async useLocalDataWithCheck(t){L.some(e=>{if(t&&t[e.backupFileKey]){console.log("diffData ~ st.backupFileKey",e.backupFileKey);return e.diffRemote(t[e.backupFileKey])}return!1})?await this.showModalAndCheckImportType(t):this.useLocalData(t)}showModalAndCheckImportType(t){return new o.a(e=>{I.create(async i=>{try{await o.a.all(L.map(async e=>{if(t&&t[e.backupFileKey])if(1===i)try{await e.mergeRemote(t[e.backupFileKey],!0),"site"===e.backupFileKey&&d.a.setRedirectVersion("")}catch(t){}else{if(0!==i)throw new Error("not check");try{await e.mergeRemote(t[e.backupFileKey],!1),"site"===e.backupFileKey&&d.a.setRedirectVersion("")}catch(t){}}}))}catch(t){console.log("ModalImportType.create ~ error",t)}e(null)})})}useRemote(t,e,i=!1){return new o.a(async s=>{if(Object(a.i)(()=>{this.waitMergeData=null,this.waitMergeId=null}),e)await o.a.all(L.map(async e=>{if(null==t?void 0:t[e.backupFileKey])try{await e.mergeRemote(t[e.backupFileKey],!0),"site"===e.backupFileKey&&d.a.setRedirectVersion("")}catch(t){}})),this.mergeType=2,this.diffColorItems(),s(null);else if(this.isRecovered)await o.a.all(L.map(async e=>{if(null==t?void 0:t[e.backupFileKey])if(i)try{await e.mergeRemote(t[e.backupFileKey],!0)}catch(t){}else{e.stopAutoBackupReaction();try{await e.mergeRemote(t[e.backupFileKey],!0)}catch(t){}e.restartAutoBackupReaction()}})),s(null);else{L.some(e=>{if(t&&t[e.backupFileKey]){console.log("diffData ~ st.backupFileKey",e.backupFileKey);return e.diffRemote(t[e.backupFileKey])}return!1})?(Object(a.i)(()=>{var e;this.waitMergeData=t,this.waitMergeId=null===(e=this.autosSyncList[0])||void 0===e?void 0:e.id}),await this.showModalAndCheckType(!0),s(null)):(this.mergeType=2,this.diffColorItems(),await o.a.all(L.map(async e=>{if(null==t?void 0:t[e.backupFileKey])try{await e.mergeRemote(t[e.backupFileKey],!0)}catch(t){}})),s(null))}})}pushAutoBackupPipe(t){b.userStore.isLogin&&this.isOpenSync&&(Object.keys(t).forEach(e=>{this.autoBackupPipe.data[e]=t[e],this.autoBackupPipe.websocketKeys.includes(e)||this.autoBackupPipe.websocketKeys.push(e)}),this.autoBackupPipe.timestamp=Date.now())}cleanupPipe(t){t===this.autoBackupPipe.timestamp&&(this.autoBackupPipe={data:{},websocketKeys:[],timestamp:0})}clearList(){this.autosSyncList=[],this.manualSyncList=[]}async diffColorItems(){await b.userStore.userProfilePromise;const t=b.userStore.userInfo["wp-color-update"];if(t===b.userStore.wpColorUpdate)return;const{mergeType:e}=this,i=await Object(j.c)(),s=Object(a.j)(p.a.customColorItems);await p.a.mergeCustomColor(s,i,Number(e),!0),b.userStore.setWpColorUpdate(t)}}x([a.g],U.prototype,"downloading",void 0),x([a.g],U.prototype,"backuping",void 0),x([a.g],U.prototype,"isBackup",void 0),x([a.g],U.prototype,"isOpenSync",void 0),x([a.g],U.prototype,"syncId",void 0),x([a.g],U.prototype,"lastSyncTime",void 0),x([a.g],U.prototype,"syncSucsess",void 0),x([a.g],U.prototype,"syncFail",void 0),x([a.g],U.prototype,"syncFailMsg",void 0),x([a.g],U.prototype,"autosSyncList",void 0),x([a.g],U.prototype,"waitMergeData",void 0),x([a.g],U.prototype,"waitMergeId",void 0),x([a.g],U.prototype,"manualSyncList",void 0),x([a.g],U.prototype,"isRecovered",void 0),x([a.g],U.prototype,"recoverErrorTimes",void 0),x([a.g],U.prototype,"master",void 0),x([a.g],U.prototype,"prerender",void 0),x([a.g],U.prototype,"autoBackupPipe",void 0),x([a.e],U.prototype,"autoSyncing",null),x([a.b],U.prototype,"changeSyncSwitch",null),x([a.b],U.prototype,"autoBackup",null),x([a.b],U.prototype,"manualBackup",null),x([a.b],U.prototype,"toSync",null),x([a.b],U.prototype,"backupEnd",null),x([a.b],U.prototype,"downloadEnd",null),x([a.b],U.prototype,"syncEnd",null),x([a.b],U.prototype,"getSyncList",null),x([a.b],U.prototype,"getDetail",null),x([a.b],U.prototype,"tiggerBackup",null),x([a.b],U.prototype,"getV1RemoteData",null),x([a.b],U.prototype,"changeRecoveredStatus",null),x([a.b],U.prototype,"getAutoLatest",void 0),x([a.b],U.prototype,"pushAutoBackupPipe",null),x([a.b],U.prototype,"cleanupPipe",null),x([a.b],U.prototype,"clearList",null),x([a.b],U.prototype,"changeSyncStatus",void 0);const W=new U;W.initSyncStore(E.i,["autoBackupPipe","syncId","lastSyncTime","isOpenSync","isRecovered","recoverErrorTimes","prerender","waitMergeData","waitMergeId","manualSyncList","autosSyncList"],void 0,50);Object(a.c)(()=>{var t;if(W.firstSync){const{isOpenSync:e,isRecovered:i,downloading:s}=W;if(b.userStore.isLogin&&e&&i&&!s&&!(null===(t=k.instance)||void 0===t?void 0:t.show)){const{data:t,websocketKeys:e,timestamp:i}=W.autoBackupPipe;(async t=>{const{data:e,websocketKeys:i,timestamp:s}=t,n=Object.assign({},e);if(Object.keys(n).length)try{const t=localStorage.getItem("lock-auto-backup");if(t&&Date.now()-Number(t)<4e3)return;localStorage.setItem("lock-auto-backup",""+Date.now()),0===W.autosSyncList.length?await o.a.all(L.map(async t=>{const e=await t.getBackupData();n[t.backupFileKey]=e})):await o.a.all(L.map(async t=>{if(i.includes(t.backupFileKey)){const e=await t.getBackupData();n[t.backupFileKey]=e}}));const{error:e}=await W.autoBackup(Object(a.j)(n),i.join(","));if(e)return;W.cleanupPipe(s),localStorage.removeItem("lock-auto-backup")}catch(t){}})({data:t,websocketKeys:e,timestamp:i})}}},{delay:4e3}),Object(a.c)(()=>{if(W.firstSync){const t=W.isOpenSync&&b.userStore.isLogin;R.slave.postTask("slave:change-sync",{status:t,userInfo:{uid:b.userStore.userInfo.uid,secret:b.userStore.userInfo.secret}}),t?W.autoRunGetAutoLatest():b.userStore.isLogin&&0===W.autosSyncList.length&&0===W.manualSyncList.length?W.getSyncList():b.userStore.isLogin||W.clearList()}},{delay:100}),Object(a.c)(()=>{W.firstSync&&(W.isOpenSync&&b.userStore.isLogin||(W.changeRecoveredStatus(!1),Object(a.i)(()=>{W.syncId="",W.waitMergeId=null,W.waitMergeData=null}),localStorage.removeItem("pre-sync-id")))}),Object(a.c)(()=>{W.firstSync&&b.userStore.isLogin&&0===b.userStore.userInfo["auto-backup"]&&0===W.autosSyncList.length&&d.a.restartAutoBackupReaction(!0)}),Object(a.c)(()=>{if(W.firstSync&&W.master){const t={downloading:W.downloading,backuping:W.backuping,syncSucsess:W.syncSucsess,syncFail:W.syncFail,syncFailMsg:W.syncFailMsg,isBackup:W.isBackup};R.slave.sendMessage("tabs-sync-status",t)}},{delay:20}),Object(a.c)(()=>{var t;W.firstSync&&W.autosSyncList.length&&(W.waitMergeId===(null===(t=W.autosSyncList[0])||void 0===t?void 0:t.id)?W.showModalAndCheckType():k.hide())},{delay:1}),window.addEventListener("beforeunload",()=>{W.master&&R.slave.sendMessage("tabs-sync-status",{downloading:!1,backuping:!1,syncSucsess:!1,syncFail:!1,syncFailMsg:"",isBackup:!1})}),Object(a.h)(()=>W.firstSync,async t=>{if(t){const t=await P();_.a.trySendStatus(t)}},{delay:1e3});const P=async()=>({currentIsLogin:!!b.userStore.isLogin,currentIsOpenSync:b.userStore.isLogin&&W.isOpenSync,currentSearchEngine:h.a.searchEngine.current.types[0].url.split("?")[0],currentWallpaper:(()=>{try{const t=p.a.type,e=["userLibraryAuto","cloudAuto"],i=["cloud","color"];if(["local","default","bing"].includes(t))return t;if(e.includes(t))return{[t]:p.a.switchType};if(i.includes(t))return"color"===t?{[t]:p.a.color}:{[t]:p.a.rawUrl}}catch(t){return"error"}})(),currentIconCount:(()=>{try{var t;const e=r()(t=d.a.sites).call(t,(t,e)=>{if(null==e?void 0:e.length){return t+r()(e).call(e,(t,e)=>{var i;return(null===(i=null==e?void 0:e.children)||void 0===i?void 0:i.length)?t+e.children.length:t+1},0)}return t},0);return 10*Math.round(e/10)}catch(t){return"error"}})(),currentVersion:C.D.extVersion,currentBrowserEnv:C.c,currentRunBrowser:C.D.runtimePlatform,currentWidth:window.screen.width*window.devicePixelRatio});_.a.sendPageView({page:"newtab"})},622:function(t,e,i){"use strict";i.d(e,"a",(function(){return E}));var s=i(99),o=i.n(s),n=i(36),r=i.n(n),a=(i(21),i(64),i(41),i(11),i(14),i(8),i(4)),c=i(29),l=i(263),d=i(93),u=i(0),h=i(9),p=i(163),y=i(249),g=i(387);function b(){p.slave.postTask("slave:bg-run-clear-wallpaper-timer-task")}var m=i(162),f=i(482),w=i(119),v=i(638),S=i.n(v),k=i(17),O=i(635),I=i(398),R=i(636),C=function(t,e,i,s){var o,n=arguments.length,r=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(r=(n<3?o(r):n>3?o(e,i,r):o(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};const j=i(524);class _ extends l.a{constructor(){super(),this.url=j,this.urlInUI=j,this.rawUrl=j,this.setWpSouceCount=t=>this.wpSourceCount=t,this.type="default",this.switchType="disabled",this.setSwitchType=t=>{this.switchType=t,this._updateTimer(!0)},this.setWpSourceCount=t=>this.wpSourceCount=t,this.wpExt="png",this.list=[],this.index=-1,this.timeEnd=0,this.remoteData=[],this.opacity=40,this.blur=0,this.setOpacity=t=>this.opacity=t,this.setBlur=t=>this.blur=t,this.liked=[],this.setLiked=t=>{this.liked=t},this.customColorItems=[],this.setCustomColorItems=t=>this.customColorItems=t,this._rgbaToHex=t=>{const e=t.replace(/rgba?\(/,"").replace(/\)/,"").replace(/[\s+]/g,"").split(","),i=parseFloat(e[3]||"1"),s=Math.floor(i*parseInt(e[0])+255*(1-i)),o=Math.floor(i*parseInt(e[1])+255*(1-i)),n=Math.floor(i*parseInt(e[2])+255*(1-i));return("0"+s.toString(16)).slice(-2)+("0"+o.toString(16)).slice(-2)+("0"+n.toString(16)).slice(-2)},this._maxCollectionlen=100,this.cloudCollection=[],this.appendCloudCollection=t=>this.cloudCollection.push(t),this.setCloudCollection=t=>this.cloudCollection=t,this._maxRecentUsedLen=100,this.cloudRecentUsedOrder={},this.setCloudRecentUsedOrder=t=>{const{cloudRecentUsedOrder:e,cloudRecentUsed:i}=this,s={};Object.keys(e).forEach(t=>{i.includes(t)&&(s[t]=e[t])}),s[t]=Date.now(),this.cloudRecentUsedOrder=s},this.cloudRecentUsed=[],this.setCloudRecentUsed=t=>{const e=Object.keys(this.cloudRecentUsedOrder);t.forEach(t=>{const i=e.indexOf(t);-1!==i&&e.splice(i,1)}),e.length>0&&e.forEach(t=>{delete this.localRecentUsedOrder[t]}),this.cloudRecentUsed=t},this.appendCloudRecentUsed=t=>{this.cloudRecentUsed.push(t),this.cloudRecentUsed=Array.from(new Set(this.cloudRecentUsed))},this.localRecentUsedOrder={},this.setLocalRecentUsedOrder=t=>{this.localRecentUsedOrder[t]=Date.now()},this.localRecentUsed=[],this.setLocalRecentUsed=t=>{const e=Object.keys(this.localRecentUsedOrder);t.forEach(t=>{const i=e.indexOf(t);-1!==i&&e.splice(i,1)}),e.length>0&&e.forEach(t=>{delete this.localRecentUsedOrder[t]}),this.localRecentUsed=t},this.appendLocalRecentUsed=t=>{this.localRecentUsed.push(t),this.localRecentUsed=Array.from(new Set(this.localRecentUsed))},this.isLibraryItem=t=>t.includes(window.__INFINITY__.wpLibraryItemId),this.isLocal=t=>t.includes(window.__INFINITY__.wpId),this.isColorItem=t=>t.includes(window.__INFINITY__.wpColorId),this.isCurrentWp=t=>this.id===t,this.diffRemote=t=>{const e=["type","switchType","timeEnd","id","wpSource","opacity","blur","customColorItems"],i=Object.keys(t).every(i=>!e.includes(i)||a.d.structural(this[i],t[i]));let s=!1;return"local"!==t.type&&t.url&&(s=this.urlInUI!==t.url),!i||s},this.nextPage=0,this.totalPage=-1,this.delay=-1,this._whenLocalSynced=async()=>{switch(function(t){Object(a.c)(()=>{const{opacity:e,blur:i}=t,s={"--wallpaper-alpha":e/100,"--wallpaper-filter":i/5+"px"};Object.keys(s).forEach(t=>{document.body.style.setProperty(t,s[t])})}),Object(a.h)(()=>t.type,e=>{e.includes("Auto")||("bing"!==e?t.wpSource&&(t.wpSource=void 0):t.wpSource=e,t.switchType="disabled",b())}),Object(a.c)(()=>{const{id:e}=t;e&&t.addRecentUsedP(e)});const e=document.querySelector(".wallpaper");Object(a.h)(()=>[t.urlInUI,t.color],([i,s])=>{"color"!==t.type?e.style.backgroundColor?(Object(y.a)("#999"),setTimeout(()=>{Object(y.b)(i)},200)):Object(y.b)(i):Object(y.a)(s)})}(this),await R.a.initStore(),this.isAuto&&this._setCloudAutoAfterInit(),this.type){case"bing":this._setBingAfterInit();break;case"userLibraryAuto":this._checkLibraryExists()}},this._syncLock=!1,this.mergeRemote=async(t,e)=>{try{if(this._syncLock)return;if(this._syncLock=!0,!("type"in t))return;if(u.n&&delete t.blur,"cloudRecentUsed"in t){if(e)this.setCloudRecentUsed(t.cloudRecentUsed);else{const e=Array.from(new Set(t.cloudRecentUsed.concat(this.cloudRecentUsed)));this.setCloudRecentUsed(e)}delete t.cloudRecentUsed}if("customColorItems"in t&&(this.mergeCustomColor(this.customColorItems,t.customColorItems,e?2:0),delete t.customColorItems),"local"===t.type)return void await this._mergeLocal(t);t.urlInUI=t.url,this._merge(t),this._afterSynced()}catch(t){console.log(t)}finally{this._syncLock=!1}},this.windmillRotating=!1,this._windmillPrevRotateSpeed=0,this._windmillPrevRotateDegree=0,this._windmillPrevRotateTime=-1,this.performWindmillRotate=t=>{if(-1===this._windmillPrevRotateTime)return this._windmillPrevRotateTime=t,void requestAnimationFrame(this.performWindmillRotate);const e=t-this._windmillPrevRotateTime;let i=this._windmillPrevRotateDegree;const{_windmillPrevRotateSpeed:s}=this;let o=s,n=0;if(this.windmillRotating)if(s<.46){let t,i;o+=36e-5*e,o>.46?(i=(o-.46)/36e-5,t=e-i,o=.46):(t=e,i=0),n=.46*i+s*t+18e-5*t*t}else n=.46*e;else{let i;o-=36e-5*e,o<0?(i=s/36e-5,o=0):i=e,0===o&&(t=-1),n=s*i-18e-5*i*i}i-=n,i%=360,i<0&&(i=360+i),this.windmillParent&&this.windmillParent.rotateWindMill(i),this._windmillPrevRotateDegree=i,this._windmillPrevRotateTime=t,this._windmillPrevRotateSpeed=o,0!==o&&requestAnimationFrame(this.performWindmillRotate)},this._lockLoadRandomP=!1,this.needSwitchWallpaper=!1,this._afterWpAutoSwitched=()=>{if(this._updateTimer(!0),!R.a.onlyOneItem)return this._prepareNextWp()},this._lockSwitchWallpaper=!1,this.timeToSwitchWallpaper=async()=>{if(!R.a.onlyOneItem&&!this._lockSwitchWallpaper){this._lockSwitchWallpaper=!0;try{await this.switchWallpaper(),await this._afterWpAutoSwitched()}finally{this._lockSwitchWallpaper=!1}}},this.switchToNextWallpaper=async()=>{try{await this.timeToSwitchWallpaper()}catch(t){d.message.top(i18n("wallpaper_switch_failure"))}},this.initAutoBackup("wallpaper",["id","url","rawUrl","wpSource","wpSourceName","type","switchType","color","timeEnd","index","opacity","blur","cloudRecentUsed","cloudRecentUsedOrder","customColorItems","nextPage","totalPage","wpExt"]),function(t){return t.initSyncStore(h.m,["id","urlInUI","rawUrl","wpSource","wpSourceCount","wpSourceName","type","switchType","imageName","imageSource","imageType","color","index","timeEnd","remoteData","opacity","blur","cloudRecentUsed","localRecentUsed","cloudRecentUsedOrder","localRecentUsedOrder","nextPage","totalPage","wpExt","customColorItems","delay"],void 0)}(this).then(this._whenLocalSynced),setTimeout(()=>{this.windmillParent=document.querySelector("newtab-main")})}_updateTimer(t=!1){const{switchType:e}=this;if(["disabled","when-newtab"].includes(e))b(),this.setTimeEnd(0);else{if(t){const t=Date.now();this.setTimeEnd(t+Object(g.a)(e))}!function(t,e){const i=Date.now(),s=Object(g.a)(e),o=t.timeEnd;let n;o>i?n=o-i:(n=s,t.setTimeEnd(i+s)),p.slave.postTask("slave:bg-run-timer-to-switch-wallpaper",n)}(this,e)}}setWpSourceName(t){this.wpSourceName=t}setWallpaper(t){const{url:e,urlInUI:i,rawUrl:s,id:o,name:n,source:r}=t;n&&(this.imageName=n),this.id=o,this.url=e,this.urlInUI=i,this.rawUrl=s,this.imageSource=r,this.setBase64Wallpaper()}async setBase64Wallpaper(){const{type:t,url:e}=this;if(["local","color"].includes(t))return;const i=await Object(g.d)(e);await Object(m.g)(i)}setColor(t){this.type="color",this.id=t.id,this.color=t.content,this.urlInUI=void 0}setCloudWallpaper(t){this.type="cloud",this.setCloudWallpaperRaw(t)}setCloudWallpaperRaw(t){this.setWallpaper({type:t.type,id:t.id,url:t.url,urlInUI:t.url,rawUrl:t.rawUrl,source:t.source})}setAutoWallpaperRaw(t){this.setWallpaper({type:t.type,id:t.id,url:t.url,urlInUI:t.url,rawUrl:t.rawUrl,source:t.source})}setWpExt(t){this.wpExt=t}async setLocalWallpaper(t){const{file:e}=t;this.setWpExt(S.a.getExtension(e.type));const i=await Object(g.d)(e);await Object(m.g)(i),this.setType("local"),this.setWallpaper({type:t.type,url:null,urlInUI:t.url,rawUrl:t.url,id:t.id})}async enableBingWallpaper(t){this.type="bing",this.wpSource="bing",this.setBingWallpaper(t)}setBingWallpaper(t){this.setCloudWallpaperRaw(t)}setList(t){this.list=t}pushList(t){this.list.push(...t)}setIndex(t){this.index=t}setTimeEnd(t){this.timeEnd=t}setRemoteData(t){this.remoteData=t}pushRemoteData(t){this.remoteData.push(...t)}spliceRemoteData(t,e=0){this.remoteData.splice(e,t)}get isAuto(){return this.type.includes("Auto")}removeLiked(t){const e=this.liked.indexOf(t);-1!==e&&this.liked.splice(e,1)}addLiked(t){const e=Object(a.j)(this.liked);e.push(t);const i=Array.from(new Set(e));this.setLiked(i)}includeLiked(t){return this.liked.includes(t)}async loadCollectionP(){const t=await Object(w.getCollectionWallpaper)();t.error||this.setCloudCollection(t.data)}async loadLikedP(){const t=await Object(w.getLikedWallpaper)();t.error||this.setLiked(t.data)}pushCustomColor(t){this.customColorItems.push(...t)}includesColorItem(t){return-1!==this.customColorItems.findIndex(({content:e})=>t===e)}appendCustomColor(t){if(-1===this.customColorItems.findIndex(({content:e})=>e===t.content)){const e=Object(a.j)(this.customColorItems);this.setCustomColorItems([t].concat(e))}}removeCustomColor(t){const e=this.customColorItems.findIndex(({id:e})=>e===t);-1!==e&&this.customColorItems.splice(e,1)}_rgbToHex(t){var e;return o()(e=t.map(t=>t.toString(16).padStart(0))).call(e,(t,e)=>t+e)}async addCustomColorItem(t){if(this.includesColorItem(t))return;const e=this._rgbaToHex(t),i=window.__INFINITY__.color_list,s=i.map(t=>k.a.hexColorDelta(e,t)),o=i[s.indexOf(Math.max.apply(null,s))],n={id:`${window.__INFINITY__.wpColorId}${Object(O.a)()}`,content:t,similarColor:o};try{f.userStore.isLogin&&await Object(w.addCustomColor)(n),this.appendCustomColor(Object.assign({type:"color"},n)),I.default.success(i18n("add_success"))}catch(t){I.default.error(i18n("network_error"))}}addCloudCollectionP(t){if(this.cloudCollection.includes(t))return;this.appendCloudCollection(t);const e=this._maxCollectionlen-this.collectionLen;if(e<0){const t=Object(a.j)(this.cloudCollection).reverse();t.length+=e,this.setCloudCollection(t.reverse())}}removeCloudCollectionP(t){const e=this.cloudCollection.indexOf(t);-1!==e&&this.cloudCollection.splice(e,1)}get collectionLen(){return this.cloudCollection.length}removeCollectionP(t){this.removeCloudCollectionP(t)}addCollectionP(t){this.addCloudCollectionP(t)}includeCollection(t){return this.cloudCollection.includes(t)}dropCloudRecentUsed(t){const e=this.cloudRecentUsed.indexOf(t);-1!==e&&this.cloudRecentUsed.splice(e,1)}get recentUsedLen(){return this.cloudRecentUsed.length+this.localRecentUsed.length}addLocalRecentP(t){if(this.setLocalRecentUsedOrder(t),this.localRecentUsed.includes(t))return;this.appendLocalRecentUsed(t);const e=this._maxRecentUsedLen-this.recentUsedLen;if(e<0){const t=Object(a.j)(this.localRecentUsed).reverse();t.length+=e,this.setLocalRecentUsed(t.reverse())}}addCloudRecentP(t){if(this.setCloudRecentUsedOrder(t),this.cloudRecentUsed.includes(t))return;this.appendCloudRecentUsed(t);const e=this._maxRecentUsedLen-this.recentUsedLen;if(e<0){const t=Object(a.j)(this.cloudRecentUsed).reverse();t.length+=e,this.setCloudRecentUsed(t.reverse())}}removeCloudRecentUsedP(t){const e=Object(a.j)(this.cloudRecentUsed);t.forEach(t=>{const i=e.indexOf(t);-1!==i&&e.splice(i,1)}),this.setCloudRecentUsed(e)}addRecentUsedP(t){this.addCloudRecentP(t)}async getBackupData(){const t={};this.backupValueKeys.forEach(e=>{t[e]=Object(a.j)(this[e])});try{if("local"===this.type){const e=await Object(m.c)();t.url=e}else t.url=this.urlInUI}catch(e){t.type="default"}return t}async _setBingAfterInit(){const t=await Object(g.b)();this.id!==t.id&&this.setCloudWallpaperRaw(t)}setDefaultWallpaper(){this.id=null,this.type="default",this.urlInUI=this.url=c.b,this.rawUrl=c.a}async _checkLibraryExists(){try{const t=await Object(w.hasWallpaperLibrary)(this.wpSource);if(t.error)throw t.error;1!==t.data&&this.setDefaultWallpaper()}catch(t){}}_setCloudAutoAfterInit(){R.a.ready?this._updateTimer(!0):this._afterWpAutoSwitched()}setType(t){this.type=t}_merge(t){Object.keys(t).forEach(e=>{this[e]!==t[e]&&(this[e]=t[e])})}async _mergeLocal(t){if("local"===this.type&&this.urlInUI.startsWith("blob:")){if(await Object(m.c)()!==t.url){const e=await Object(m.a)(t.url);t.urlInUI=t.rawUrl=r.a.createObjectURL(e),await Object(m.g)(t.url)}else delete t.urlInUI,delete t.rawUrl}else{const e=await Object(m.a)(t.url);t.urlInUI=t.rawUrl=r.a.createObjectURL(e),await Object(m.g)(t.url)}delete t.url;const e=t.wpExt;delete t.wpExt,this._merge(t),t.id?this.setWpExt(e):this.setWpExt(""),this._afterSynced()}async mergeCustomColor(t,e,i,s=!1){switch(i){case 1:if(0===t.length)return;await Object(w.setCustomColorItems)(t.map(t=>(delete t.type,t)));break;case 2:E.setCustomColorItems(e.map(t=>(t.type="color",t)));break;case 0:{const i=[],o=[];for(let e=0,s=t.length;e<s;++e){const s=t[e];o.includes(s.id)||(i.push(s),o.push(s.id))}for(let t=0,s=e.length;t<s;++t){const s=e[t];o.includes(s.id)||(i.push(s),o.push(s.id))}s&&await Object(w.setCustomColorItems)(i.map(t=>(delete t.type,t))),E.setCustomColorItems(i.map(t=>("type"in t||(t.type="color"),t)))}}}_afterSynced(){c.e&&Object(a.i)(()=>{this.url=this.url.replace(c.f,""),this.urlInUI=this.urlInUI.replace(c.f,"")}),this.setBase64Wallpaper(),this.isAuto&&(this._updateTimer(),this._prepareNextWp())}startRotateWindmill(){this.windmillRotating=!0,0===this._windmillPrevRotateSpeed&&requestAnimationFrame(this.performWindmillRotate)}endRotateWindmill(){this.windmillRotating=!1}async randomWallpaper(){if(!this._lockLoadRandomP){this._lockLoadRandomP=!0,this.startRotateWindmill();try{const{data:t,error:e}=await Object(w.getRandomWallpaper)();if(e)throw new Error(JSON.stringify(e));const i=await Object(m.f)(t.url);if(!i)throw new Error("fetch res to check :"+i);this.setCloudWallpaper(Object.assign({type:"cloud"},t)),d.message.top(i18n("wallpaper_switch_success"))}catch(t){d.message.top(i18n("wallpaper_switch_failure"))}finally{this._lockLoadRandomP=!1,this.endRotateWindmill()}}}async getNextWp(...t){const{data:e}=await Object(w.getNextWallpaper)(...t),[i]=Object(m.b)([e]);return i}async _prepareNextWp(){try{const t="userLibraryAuto"!==this.type?"library":"userLibrary",e=await this.getNextWp(this.wpSource,this.id,t);e.id===this.id?R.a.setOnlyOneItem(!0):R.a.setOnlyOneItem(!1),await Object(m.f)(e.url),R.a.setNextId(e.id),R.a.setNextRawURL(e.rawUrl),R.a.setNextURL(e.url),R.a.setNextItem(e),R.a.setReady(!0)}catch(t){if(!t.__CANCEL__)throw t}}enableUserLibraryAuto({libraryId:t,libraryName:e},i,s){this.type="userLibraryAuto",this.switchType=i,this.wpSource=t,this.wpSourceName=e,this._afterEnableWpAuto(s)}enableCloudAuto(t,e,i){this.type="cloudAuto",this.wpSource=t,this.switchType=e,this._afterEnableWpAuto(i)}_afterEnableWpAuto(t){this.setAutoWallpaperRaw(t),R.a.setOnlyOneItem(!1),this._afterWpAutoSwitched()}async switchWallpaper(){R.a.onlyOneItem||R.a.ready||await this._prepareNextWp(),this.setAutoWallpaperRaw(R.a.nextItem),R.a.setReady(!1),R.a.clearNextData()}}C([a.g],_.prototype,"id",void 0),C([a.g],_.prototype,"url",void 0),C([a.g],_.prototype,"urlInUI",void 0),C([a.g],_.prototype,"rawUrl",void 0),C([a.g],_.prototype,"wpSource",void 0),C([a.g],_.prototype,"wpSourceCount",void 0),C([a.b],_.prototype,"setWpSouceCount",void 0),C([a.g],_.prototype,"type",void 0),C([a.g],_.prototype,"switchType",void 0),C([a.b],_.prototype,"setSwitchType",void 0),C([a.b],_.prototype,"setWpSourceCount",void 0),C([a.g],_.prototype,"wpSourceName",void 0),C([a.b],_.prototype,"setWpSourceName",null),C([a.g],_.prototype,"imageName",void 0),C([a.g],_.prototype,"imageSource",void 0),C([a.g],_.prototype,"imageType",void 0),C([a.b],_.prototype,"setWallpaper",null),C([a.g],_.prototype,"color",void 0),C([a.b],_.prototype,"setColor",null),C([a.b],_.prototype,"setCloudWallpaper",null),C([a.b],_.prototype,"setCloudWallpaperRaw",null),C([a.b],_.prototype,"setAutoWallpaperRaw",null),C([a.g],_.prototype,"wpExt",void 0),C([a.b],_.prototype,"setWpExt",null),C([a.b],_.prototype,"enableBingWallpaper",null),C([a.b],_.prototype,"setBingWallpaper",null),C([a.g],_.prototype,"list",void 0),C([a.b],_.prototype,"setList",null),C([a.b],_.prototype,"pushList",null),C([a.g],_.prototype,"index",void 0),C([a.b],_.prototype,"setIndex",null),C([a.g],_.prototype,"timeEnd",void 0),C([a.b],_.prototype,"setTimeEnd",null),C([a.g],_.prototype,"remoteData",void 0),C([a.b],_.prototype,"setRemoteData",null),C([a.b],_.prototype,"pushRemoteData",null),C([a.b],_.prototype,"spliceRemoteData",null),C([a.g],_.prototype,"opacity",void 0),C([a.g],_.prototype,"blur",void 0),C([a.b],_.prototype,"setOpacity",void 0),C([a.b],_.prototype,"setBlur",void 0),C([a.e],_.prototype,"isAuto",null),C([a.g],_.prototype,"liked",void 0),C([a.b],_.prototype,"setLiked",void 0),C([a.b],_.prototype,"removeLiked",null),C([a.b],_.prototype,"addLiked",null),C([a.g],_.prototype,"customColorItems",void 0),C([a.b],_.prototype,"setCustomColorItems",void 0),C([a.b],_.prototype,"pushCustomColor",null),C([a.b],_.prototype,"removeCustomColor",null),C([a.b],_.prototype,"addCustomColorItem",null),C([a.g],_.prototype,"cloudCollection",void 0),C([a.b],_.prototype,"appendCloudCollection",void 0),C([a.b],_.prototype,"setCloudCollection",void 0),C([a.b],_.prototype,"addCloudCollectionP",null),C([a.b],_.prototype,"removeCloudCollectionP",null),C([a.e],_.prototype,"collectionLen",null),C([a.g],_.prototype,"cloudRecentUsed",void 0),C([a.b],_.prototype,"dropCloudRecentUsed",null),C([a.b],_.prototype,"setCloudRecentUsed",void 0),C([a.b],_.prototype,"appendCloudRecentUsed",void 0),C([a.g],_.prototype,"localRecentUsed",void 0),C([a.b],_.prototype,"setLocalRecentUsed",void 0),C([a.b],_.prototype,"appendLocalRecentUsed",void 0),C([a.e],_.prototype,"recentUsedLen",null),C([a.b],_.prototype,"addLocalRecentP",null),C([a.b],_.prototype,"addCloudRecentP",null),C([a.b],_.prototype,"removeCloudRecentUsedP",null),C([a.g],_.prototype,"delay",void 0),C([a.b],_.prototype,"setDefaultWallpaper",null),C([a.b],_.prototype,"_setCloudAutoAfterInit",null),C([a.b],_.prototype,"setType",null),C([a.b],_.prototype,"_merge",null),C([a.b],_.prototype,"mergeRemote",void 0),C([a.b],_.prototype,"randomWallpaper",null),C([a.b],_.prototype,"enableUserLibraryAuto",null),C([a.b],_.prototype,"enableCloudAuto",null),C([a.b],_.prototype,"switchWallpaper",null);const E=new _},623:function(t,e,i){"use strict";i.r(e),i.d(e,"weatherStore",(function(){return v})),i.d(e,"getCurrentWeather",(function(){return S}));var s=i(6),o=i.n(s),n=i(490),r=i.n(n),a=(i(11),i(14),i(8),i(4)),c=i(23),l=i(17),d=i(263),u=i(0);const h={100:i18n("w_100"),101:i18n("w_101"),102:i18n("w_102"),103:i18n("w_103"),104:i18n("w_104"),200:i18n("w_200"),201:i18n("w_201"),202:i18n("w_202"),203:i18n("w_203"),204:i18n("w_204"),205:i18n("w_205"),206:i18n("w_206"),207:i18n("w_207"),208:i18n("w_208"),209:i18n("w_209"),210:i18n("w_210"),211:i18n("w_211"),212:i18n("w_212"),213:i18n("w_213"),300:i18n("w_300"),301:i18n("w_301"),302:i18n("w_302"),303:i18n("w_303"),304:i18n("w_304"),305:i18n("w_305"),306:i18n("w_306"),307:i18n("w_307"),308:i18n("w_308"),309:i18n("w309"),310:i18n("w_310"),311:i18n("w_311"),312:i18n("w_312"),313:i18n("w_313"),314:i18n("w_314"),315:i18n("w_315"),316:i18n("w_316"),317:i18n("w_317"),318:i18n("w_318"),399:i18n("w_399"),400:i18n("w_400"),401:i18n("w_401"),402:i18n("w_402"),403:i18n("w_403"),404:i18n("w_404"),405:i18n("w_405"),406:i18n("w_406"),407:i18n("w_407"),408:i18n("w_408"),409:i18n("w_409"),410:i18n("w_410"),499:i18n("w_499"),500:i18n("w_500"),501:i18n("w_501"),502:i18n("w_502"),503:i18n("w_503"),504:i18n("w_504"),507:i18n("w_507"),508:i18n("w_508"),509:i18n("w_509"),510:i18n("w_510"),511:i18n("w_511"),512:i18n("w_512"),513:i18n("w_513"),514:i18n("w_514"),515:i18n("w_515"),900:i18n("w_900"),901:i18n("w_901"),999:i18n("w_999")},p={alyBGColor(t){let e="#36B3FF";switch(t.conditionCode){case"100":case"101":case"102":case"103":case"104":e="#0F7CFF";break;case"200":case"201":case"202":case"203":case"204":case"205":case"206":e="#10BDFF";break;case"207":case"208":case"209":case"210":case"211":case"212":e="#096BB2";break;case"213":case"900":e="#FF7F3B";break;case"300":case"301":case"302":case"303":case"304":case"305":case"306":case"307":case"308":case"309":case"310":case"311":case"312":case"313":case"314":case"315":case"316":case"317":case"318":case"399":e="#427BD1";break;case"301":case"300":case"402":case"403":case"404":case"405":case"406":case"407":case"408":case"409":case"410":case"4991":e="#87A6D5";break;case"500":case"501":case"502":case"503":case"504":case"505":case"506":case"507":case"508":case"509":case"510":case"511":case"512":case"513":case"514":case"515":case"999":e="#98A6BD";break;default:e="#0441C5"}return e},alyWIcon:t=>`${u.a}/weather/code_${t.conditionCode}.png`,alyText:t=>h[t.conditionCode]};function y(t,e,i){let s,o;return"celsius"===e?(s=t,o="°C"):(s=Math.floor(1.8*t+32),o="°F"),i&&(s+=o),s}var g=i(265),b=i(9),m=function(t,e,i,s){var o,n=arguments.length,r=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(r=(n<3?o(r):n>3?o(e,i,r):o(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r},f=function(t,e){var i={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(i[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(t);o<s.length;o++)e.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(t,s[o])&&(i[s[o]]=t[s[o]])}return i};class w extends d.a{constructor(){super(...arguments),this.localData={},this.list=[],this.lastUpdated=+new Date,this.unit="celsius",this.isShowModal=!1,this.isShowSetting=!1,this.searchState="none",this.citys=[]}get formateList(){return this.list.filter(t=>t.items).map(t=>{var e=f(t,[]);return e.items=e.items.map((t,e)=>{var i=f(t,[]);return 0===e&&(i._bgColor=p.alyBGColor(i),i._text=p.alyText(i)),i._bgImg=p.alyWIcon(i),i}),e})}sortList(t){this.list=t}changeIndex(t,e){var i;if(t===e)return;let s=[...this.list];const o=s.findIndex(e=>e.cid===t);if(-1===o)return;if("bottom"===e){const[t]=s.splice(o,1);s.push(t)}else if("top"===e){const[t]=s.splice(o,1);s.unshift(t)}else{const t=s.findIndex(t=>t.cid===e);if(-1===t)return;const[i]=s.splice(o,1);s.splice(t,0,i)}const n=(null===(i=this.list.filter(t=>t.top)[0])||void 0===i?void 0:i.name)||"";(n===t||n===e)&&(s=this.list.map(t=>t.top?Object.assign(Object.assign({},t),{top:0}):t)),this.list=s}openModal(){this.isShowModal=!0}closeModal(){this.isShowModal=!1,this.searchCitys("")}updateList(t){this.list=t}diffRemote(t){var e;if((null===(e=null==t?void 0:t.list)||void 0===e?void 0:e.length)!==this.list.length)return!0;if(this.unit!==t.unit)return!0;return this.list.some((e,i)=>e.cid!==t.list[i].cid)}async mergeRemote(t,e){if(t.list)try{const i=await this.getWeatherByCid(t.list);Object(a.i)(()=>{if(this.unit=t.unit,e)this.list=i;else{const t=this.list,e=i,{result:s}=l.a.mergeArray(t,e,"cid","updateTime");this.list=s}})}catch(t){}}async getWeatherByCid(t){t=t.filter(t=>t.name&&t.cid&&t.items);return await o.a.all(t.map(async t=>{if(t.cid){const e=await c.i.getForecastWeather(t.cid);if(null==e?void 0:e.data){return Object.assign(Object.assign({},e.data),{name:t.name})}}}))}async initLocal(){const t=await c.i.getLocalCity();Object(a.i)(()=>{t&&(this.localData=t.data)})}async addCity(t,e){const{data:i}=await c.i.getForecastWeather(t);if(!i)throw new Error(i18n("no_current_city_weather_data"));Object(a.i)(()=>{for(const e in this.list)if(this.list[e].cid===t)throw new Error(i18n("repeat_city"));this.list.push(Object.assign(Object.assign({},i),{cid:t,name:e})),this.lastUpdated=+new Date,this.closeModal()})}async searchCitys(t){if(!t)return this.citys=[],void(this.searchState="none");this.searchState="ing";try{const{data:e}=await c.i.getCityList(t);e?Object(a.i)(()=>{if(200===e.status){this.searchState="done";const t=e.cities.filter(t=>!this.filterCity(t.cid));this.citys=t}}):Object(a.i)(()=>{this.searchState="error"})}catch(t){Object(a.i)(()=>{this.searchState="error"})}}filterCity(t){const e=t.substr(t.length-1);return/^[a-zA-Z]+$/.test(e)}changeSelected(t,e){this.citys[t].selected=e}deleteCityWeather(t){let e=-1;for(const i in this.list)t===this.list[i].cid&&(e=Number(i));this.list.splice(e,1),this.lastUpdated=+new Date}changeUnit(){this.unit="celsius"===this.unit?"fahrenheit":"celsius",g.a.sendEvent({settingAction:{weatherUnit:this.unit}})}toggleSetting(){this.isShowSetting=!this.isShowSetting}closeSetting(){this.isShowSetting=!1}reset(){this.isShowSetting=!1,this.isShowModal=!1}toTop(t,e){var i;this.list=r()(i=this.list.map(i=>i.cid===t?Object.assign(Object.assign({},i),{top:0===e?1:0}):Object.assign(Object.assign({},i),{top:0}))).call(i,(t,e)=>e.top-t.top)}toggleOpen(t){this.list=this.list.map(e=>e.cid===t?Object.assign(Object.assign({},e),{open:0===e.open?1:0}):Object.assign({},e))}}m([a.g],w.prototype,"localData",void 0),m([a.g],w.prototype,"list",void 0),m([a.g],w.prototype,"lastUpdated",void 0),m([a.g],w.prototype,"unit",void 0),m([a.g],w.prototype,"isShowModal",void 0),m([a.g],w.prototype,"isShowSetting",void 0),m([a.g],w.prototype,"searchState",void 0),m([a.g],w.prototype,"citys",void 0),m([a.e],w.prototype,"formateList",null),m([a.b],w.prototype,"sortList",null),m([a.b],w.prototype,"changeIndex",null),m([a.b],w.prototype,"openModal",null),m([a.b],w.prototype,"closeModal",null),m([a.b],w.prototype,"updateList",null),m([a.b],w.prototype,"mergeRemote",null),m([a.b],w.prototype,"addCity",null),m([a.b],w.prototype,"searchCitys",null),m([a.b],w.prototype,"changeSelected",null),m([a.b],w.prototype,"deleteCityWeather",null),m([a.b],w.prototype,"changeUnit",null),m([a.b],w.prototype,"toggleSetting",null),m([a.b],w.prototype,"closeSetting",null),m([a.b],w.prototype,"reset",null),m([a.b],w.prototype,"toTop",null),m([a.b],w.prototype,"toggleOpen",null);const v=new w;v.initSyncStore(b.n,["localData","list","unit","lastUpdated"],{}),v.initAutoBackup("weather",["list","unit"]);const S=()=>{const t=v.formateList[0],e=null==t?void 0:t.items[0];if(!e)return{};return{name:y(e.tmpMax,v.unit,!0),bgColor:e._bgColor,bgImg:e._bgImg}};Object(a.c)(()=>{v.list.some(t=>!t||!t.cid)&&(u.j&&alert("error"),Object(a.i)(()=>{v.list=v.list.filter(t=>(null==t?void 0:t.name)&&(null==t?void 0:t.cid)&&(null==t?void 0:t.items))}))})},625:function(t,e,i){"use strict";i.d(e,"a",(function(){return S}));var s=i(99),o=i.n(s),n=i(490),r=i.n(n),a=(i(11),i(14),i(41),i(8),i(277),i(21),i(4)),c=i(401),l=i.n(c),d=i(263),u=i(483),h=i(17),p=i(0),y=i(193),g=i(484),b=i(623),m=i(23),f=i(9),w=function(t,e,i,s){var o,n=arguments.length,r=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(r=(n<3?o(r):n>3?o(e,i,r):o(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};class v extends d.a{constructor(){super(...arguments),this.sites=[],this.editingId=null,this.currentPageIndex=0,this.redirectVersion="",this.mergeSiteArray=(t,e,i)=>{const s=t=>{if("object"==typeof t){if(t.target===y.i.target){const e=["target","uuid"];return o()(e).call(e,(e,i)=>e+t[i],"")}{var e;const i=r()(e=Object.keys(t).filter(t=>"id"!==t&&"updatetime"!==t)).call(e);return o()(i).call(i,(e,i)=>e+t[i],"")}}},n=(t=>{const e=Object.create(null),i=t=>{t.forEach(t=>{var s;if(Array.isArray(t))i(t);else if(t&&t.id){const o=t.id;e[o]=t,(null===(s=t.children)||void 0===s?void 0:s.length)>0&&i(t.children)}})};return i(t),e})(e),a=(t=>{const e=Object.create(null),i=t=>{t.forEach(t=>{var o;if(Array.isArray(t))i(t);else if("object"==typeof t)if((null===(o=t.children)||void 0===o?void 0:o.length)>0)i(t.children);else{const i=s(t);e[i]=!0}})};return i(t),e})(e);let c=!1;t.forEach((e,i)=>{t[i]=e.filter(t=>{var e;const i=n[t.id],o=t.updatetime||0;if((null===(e=t.children)||void 0===e?void 0:e.length)>0){if(i){return o>(i.updatetime||0)&&(c=!0,i.name=t.name),t.children.forEach(t=>{if(n[t.id]){const e=n[t.id].updatetime||0;(t.updatetime||0)>e&&(c=!0,Object.assign(n[t.id],t))}else c=!0,i.children.push(t)}),!1}return t.children=t.children.filter(t=>{if(n[t.id]){const e=n[t.id].updatetime||0;return(t.updatetime||0)>e&&(c=!0,Object.assign(n[t.id],t)),!1}return!0}),0!==t.children.length&&(1===t.children.length&&(Object.assign(t,t.children[0]),delete t.children),!0)}{if(!t.updatetime)return!1;const e=s(t);if(a[e])return!1;if(i){return o>(i.updatetime||0)&&(c=!0,Object.assign(n[t.id],t)),!1}return!0}})});const l=[];if(t.forEach(t=>{t.forEach(t=>{l.push(t)})}),l.length>0&&e.length>0){c=!0;let t=e.length-1;l.forEach(s=>{e[t].length<i?e[t].push(s):(t+=1,e[t]=[s])})}return{result:e,isLocalEffective:c}},this.convertBackupEquals=t=>{const{sites:e}=t;return(null==e?void 0:e.length)&&e.forEach(t=>{(null==t?void 0:t.length)&&t.forEach(t=>{(null==t?void 0:t.uuid)===y.i.uuid?(t.name=void 0,t.bgColor=void 0,t.bgImage=void 0):(null==t?void 0:t.children)&&t.children.forEach(t=>{(null==t?void 0:t.uuid)===y.i.uuid&&(t.name=void 0,t.bgColor=void 0,t.bgImage=void 0)})})}),t},this.reSortTimer=null,this.reSort=(t,e)=>{clearTimeout(this.reSortTimer),this.reSortTimer=setTimeout(()=>{var i;const s=t*e,n=o()(i=this.sites).call(i,(t,e)=>t.concat(e),[]),r=Array(Math.ceil(n.length/s)).fill(null);Object(a.i)(()=>{this.sites=r.map((t,e)=>n.slice(e*s,(e+1)*s))})},0)}}get uids(){const t=new Set;return(g.pluginStore.pluginViews.includes("infinity://settings")||g.pluginStore.pluginViews.includes("profile"))&&this.sites.forEach(e=>{e.filter(t=>t).forEach(e=>{e.children?e.children.forEach(e=>{t.add(e.uuid+"#"+e.target)}):t.add(e.uuid+"#"+e.target)})}),t}changeCurrentPage(t){this.currentPageIndex=t}diffRemote(t){const e=t=>{if((null==t?void 0:t.target)===y.i.target){const e={name:void 0,bgColor:void 0,bgImage:void 0};return Object.assign(Object.assign({},t),e)}},i=l()(t.sites||[],e),s=l()(Object(a.j)(this.sites),e);return!a.d.structural(i,s)}mergeRemote(t,e){if(!t.sites)return;const i=Object(b.getCurrentWeather)();if(e)this.setWeatherIcon(t.sites,i),this.sites=t.sites;else{const{col:e,row:s}=u.b.setting.layout,o=e*s,{result:n}=this.mergeSiteArray(Object(a.j)(this.sites),t.sites,o);this.setWeatherIcon(n,i),this.sites=n}this.sites.length?this.sites.length-1<this.currentPageIndex&&document.querySelector("newtab-main").toPage(this.sites.length-1):this.currentPageIndex=0}clearEditSite(){this.editingId=null}setEditSite(t){this.editingId=t}delSites(t=[],e=!0){var i,s,o;const[n,r,a]=t;let c,l=null;return 2===t.length?c=this.sites[n].splice(r,1):3===t.length&&(c=null===(s=null===(i=this.sites[n][r])||void 0===i?void 0:i.children)||void 0===s?void 0:s.splice(a,1)),e&&this.finishingSites(t[0]),2===t.length&&0===(null===(o=this.sites[n])||void 0===o?void 0:o.length)&&(l=n),{data:c,clearPageIndex:l}}insertSite(t=[],e){var i,s;const[o,n,r]=t;2===t.length?o!==this.sites.length||this.sites[o]?this.sites[o].splice(n,0,e):this.sites.push([e]):3===t.length&&(null===(s=null===(i=this.sites[o][n])||void 0===i?void 0:i.children)||void 0===s||s.splice(r,0,e))}handelStatus(t,e,i,s,o){const[n]=t;let[r]=e;if(null!==o&&o<r&&(r-=1,document.querySelector("newtab-main")._toPrevPage(!0)),3===t.length&&i.children.length<2){const t=this.findIndex(n,i.id);this.destroyFolder(t),r-=1}const a=null!==o?Math.min(o,r):r;return this.finishingSites(Math.max(a,0)),this.findIndex(r,s.id)}findIndex(t,e){const i=[];for(let s=Math.max(t||0,0);s<this.sites.length;s++){const t=this.sites[s];i[0]=s;if(t.find((t,s)=>t.id===e?(i[1]=s,!0):!!t.children&&t.children.find((t,o)=>t.id===e&&(i[1]=s,i[2]=o,!0))))return i}}findIcon(t,e){let i={};for(let s=Math.max(t||0,0);s<this.sites.length;s++){if(this.sites[s].some(t=>t.id===e?(i=t,!0):!!t.children&&t.children.some(t=>t.id===e&&(i=t,!0))))return i}return i}destroyFolder(t){const[e,i]=t,s=this.sites[e][i].children;0===s.length?this.sites[e].splice(i,1):(this.sites[e][i]=s.shift(),s.length>0&&this.sites[e].push(...s))}manualDestroyFolder(t){const[e,i]=t,s=this.sites[e][i].children;this.sites[e].splice(i,1);const{col:o,row:n}=u.b.setting.layout,r=o*n-this.sites[e].length;if(r>=s.length)this.sites[e].push(...s);else{const t=s.splice(0,r);this.sites[e].push(...t);const i=this.sites.length-1;this.sites[i].push(...s),this.finishingSites(i)}}finishingSites(t=0){const{col:e,row:i}=u.b.setting.layout,s=e*i,o=t=>{if(this.sites.length<=t)return;const e=this.sites[t].length;if(e>s){const i=t+1,n=this.sites[t].splice(s,e-s);this.sites.length>i?this.sites[i].unshift(...n):this.sites.push(n),o(i)}else 0===e?(t&&t===this.sites.length-1&&document.querySelector("newtab-main").toPage(t-1),this.sites.splice(t,1),o(t)):o(t+1)};o(t);for(let t=0;t<this.sites.length;){const e=this.sites[t];e&&e.length||(this.sites.splice(t,1),t-=1),t+=1}}addSite(t,e=0){if(this.sites.length>e){const{col:i,row:s}=u.b.setting.layout,o=i*s;return this.sites[e].length<o?(this.sites[e].push(t),e):this.addSite(t,e+1)}return this.sites[e]=[t],e}isIcon(t,e){return!this.findIcon(t,e).children}changeFolderName(t,e){const[i,s]=t;this.sites[i][s].name=e,this.sites[i][s].updatetime=Date.now()}setWeatherIcon(t,e){t.forEach(t=>{t&&t.forEach(t=>{t.target===y.i.target&&(t.name=e.name||y.i.name,t.bgColor=e.bgColor||y.i.bgColor,t.bgImage=e.bgImg||y.i.bgImage),t.children&&t.children.forEach(t=>{t.target===y.i.target&&(t.name=e.name||y.i.name,t.bgColor=e.bgColor||y.i.bgColor,t.bgImage=e.bgImg||y.i.bgImage)})})})}async submitSite(t){if("color"===t.bgType?delete t.bgImage:"image"===t.bgType&&(delete t.bgFont,delete t.bgText,delete t.bgColorImage,"transparent"===t.bgColor&&(t.bgColor=void 0)),t.updatetime=await h.a.getTimestamp(),this.editingId){const e=document.querySelector("newtab-main").iconSearchShow,i=this.findIcon(e?0:this.currentPageIndex,this.editingId);let s={};Object(a.i)(()=>{if(s=Object.assign(i,t),s.target===y.i.target){const t=Object(b.getCurrentWeather)();this.setWeatherIcon(S.sites,t)}})}else{const e=Object.assign({uuid:h.a.randomId("site-"),id:h.a.randomId("siteId-"),type:"web"},t),i=S.addSite(e,this.currentPageIndex);if(e.target===y.i.target){const t=Object(b.getCurrentWeather)();this.setWeatherIcon(S.sites,t)}document.querySelector("newtab-main").toPage(i)}return null}async getRedirectTargets(){const{data:t,error:e}=await m.b.getRedirectTargets(this.redirectVersion);if(!e&&t){const{list:e,version:i}=t;this.setRedirectVersion(i),this.userRedirect(e)}}setRedirectVersion(t){this.redirectVersion=t}userRedirect(t){t.forEach(t=>{let{matchs:e,version:i,target:s}=t;e=e.map(t=>new RegExp(t)),this.sites.forEach(t=>{t.forEach(t=>{var o;(null===(o=t.children)||void 0===o?void 0:o.length)?t.children.forEach(t=>{t.target&&e.some(e=>e.test(t.target))&&t.rVersion!==i&&(t.rVersion=i,t.target=s)}):t.target&&e.some(e=>e.test(t.target))&&t.rVersion!==i&&(t.rVersion=i,t.target=s)})})})}}w([a.g],v.prototype,"sites",void 0),w([a.g],v.prototype,"editingId",void 0),w([a.g],v.prototype,"currentPageIndex",void 0),w([a.g],v.prototype,"redirectVersion",void 0),w([a.e],v.prototype,"uids",null),w([a.b],v.prototype,"changeCurrentPage",null),w([a.b],v.prototype,"mergeRemote",null),w([a.b],v.prototype,"clearEditSite",null),w([a.b],v.prototype,"setEditSite",null),w([a.b],v.prototype,"delSites",null),w([a.b],v.prototype,"insertSite",null),w([a.b],v.prototype,"destroyFolder",null),w([a.b],v.prototype,"manualDestroyFolder",null),w([a.b],v.prototype,"finishingSites",null),w([a.b],v.prototype,"reSort",void 0),w([a.b],v.prototype,"addSite",null),w([a.b],v.prototype,"changeFolderName",null),w([a.b],v.prototype,"setWeatherIcon",null),w([a.b],v.prototype,"submitSite",null),w([a.b],v.prototype,"setRedirectVersion",null),w([a.b],v.prototype,"userRedirect",null);const S=new v;S.initSyncStore(f.h,["sites","redirectVersion"],{sites:Object(y.f)(p.D.lang)}),S.initAutoBackup("site",["sites"]),Object(a.h)(()=>[u.b.setting.layout.col,u.b.setting.layout.row].join(","),()=>{S.firstSync&&setTimeout(()=>{Object(u.a)(!1)},0)},{delay:0});const k=()=>{requestIdleCallback(()=>{S.firstSync?(S.sites.forEach((t,e)=>{t&&0!==t.length||Object(a.i)(()=>{S.sites.splice(e,1)})}),S.sites.forEach((t,e)=>{t.forEach((t,i)=>{t||Object(a.i)(()=>{S.sites[e].splice(i,1)})})})):k()})};setTimeout(()=>{k()},60),Object(a.c)(()=>{if(b.weatherStore.firstSync){const t=Object(b.getCurrentWeather)();S.setWeatherIcon(S.sites,t)}},{delay:20}),Object(a.c)(()=>{S.firstSync&&requestIdleCallback(()=>{S.getRedirectTargets()})},{delay:20}),u.b.changeLayout(S.reSort)},626:function(t,e,i){"use strict";i.d(e,"a",(function(){return f}));var s=i(490),o=i.n(s),n=i(99),r=i.n(n),a=(i(11),i(14),i(41),i(8),i(4)),c=i(263),l=i(193),d=i(17),u=i(23),h=i(0),p=i(482),y=i(9),g=function(t,e,i,s){var o,n=arguments.length,r=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(r=(n<3?o(r):n>3?o(e,i,r):o(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};const b=h.D.isZh?l.a:l.b;class m extends c.a{constructor(){super(...arguments),this.list=[],this.defaultSearch=l.e,this.listHash="",this.version="",this.lang="",this.ignoreSuggest=!1,this.searchEngine={custom:[],addList:[],current:b,all:[]},this.convertBackupEquals=t=>{var e,i;let s=null===(e=null==t?void 0:t.searchEngine)||void 0===e?void 0:e.all,o=null===(i=null==t?void 0:t.searchEngine)||void 0===i?void 0:i.current;if(s&&(s=t.searchEngine.all.map(t=>t.uuid)),o&&(o=t.searchEngine.current.uuid),s||o){const e=Object.assign(Object.assign({},t.searchEngine),{all:s,current:o});return Object.assign(Object.assign({},t),{searchEngine:e})}return t},this.mergeAddArray=(t=[],e=[])=>{const i="uuid";if(!t||0===t.length)return{result:e||[],isLocalEffective:!1};const s=e.filter(t=>!!t),n=t=>{if("object"==typeof t){var e;const i=o()(e=Object.keys(t).filter(t=>"uuid"!==t&&"updatetime"!==t)).call(e);return r()(i).call(i,(e,i)=>e+t[i],"")}},a=(t=>{const e=Object.create(null);return t.forEach(t=>{const i=n(t);e[i]=!0}),e})(e),c=Object.create(null);e.forEach((t,e)=>{if(t[i]){const s=t[i];c[s]=e}});let l=!1;return t.filter(t=>0!==t.updatetime).forEach(t=>{const e=n(t);if(a[e])return;const o=t[i],r=c[o];if(void 0!==r){(s[r].updatetime||0)<(t.updatetime||0)&&(s[r]=t,l=!0)}else l=!0,s.push(t)}),{result:s.filter(t=>!!t),isLocalEffective:l}}}get allItems(){return[this.defaultSearch,...this.searchEngine.all]}diffRemote(t){var e,i;const s=t.searchEngine||{};if(JSON.stringify(s.addList||{})!==JSON.stringify(this.searchEngine.addList))return!0;if(JSON.stringify(s.custom||{})!==JSON.stringify(this.searchEngine.custom))return!0;if((null===(e=s.current)||void 0===e?void 0:e.uuid)!==this.searchEngine.current.uuid)return!0;if((null===(i=s.all)||void 0===i?void 0:i.length)!==this.searchEngine.all.length)return!0;return this.searchEngine.all.some((t,e)=>{var i,o;return(null===(o=null===(i=s.all)||void 0===i?void 0:i[e])||void 0===o?void 0:o.uuid)!==t.uuid})}mergeRemote(t,e){if(t.searchEngine)if(e)this.searchEngine=this.transformSearchI18n(t.searchEngine);else{const e=this.searchEngine.custom,i=t.searchEngine.custom,{result:s}=d.a.mergeArray(e,i,"uuid"),o=this.searchEngine.addList,n=t.searchEngine.addList,{result:r}=this.mergeAddArray(o,n),a=this.searchEngine.all,c=t.searchEngine.all,{result:l}=d.a.mergeArray(a,c,"uuid");this.searchEngine=this.transformSearchI18n({custom:s,addList:r,current:t.searchEngine.current,all:l})}}transformSearchI18n(t){const e=Object.create(null);this.list.forEach(t=>{e[t.uuid]=t});const i=t=>e[t.uuid]?Object.assign(Object.assign({},t),e[t.uuid]):t;return{custom:t.custom,addList:t.addList,current:i(t.current),all:t.all.map(t=>i(t))}}setActive(t){this.searchEngine.current=this.allItems[t]}closeSuggestTips(){this.ignoreSuggest=!0}delShortcut(t){const e=this.searchEngine.all.findIndex(e=>e.uuid===t);e>-1&&this.searchEngine.all.splice(e,1)}updateShortcut(t){if(t){this.searchEngine.all.some((e,i)=>e.uuid===t.uuid&&(this.searchEngine.all[i]=t,!0))||this.searchEngine.all.push(t);const e=this.searchEngine.current.uuid;t.uuid===e&&(this.searchEngine.current=t)}}createEngine(t,e=null){if(null===e){const e=d.a.randomId("custom-search-"),i=Object.assign(Object.assign({},t),{uuid:e});return this.searchEngine.custom.push(i),i}return this.searchEngine.custom[e]=Object.assign(Object.assign({},this.searchEngine.custom[e]),t),this.searchEngine.custom[e]}delEngine(t){const{uuid:e}=this.searchEngine.custom[t];return e!==this.searchEngine.current.uuid&&(this.delShortcut(e),this.searchEngine.custom.splice(t,1),!0)}createEngineAdd(t,e=null){if(null===e){const e=d.a.randomId("add-search-"),i=Object.assign(Object.assign({},t),{uuid:e});return this.searchEngine.addList.push(Object.assign(Object.assign({},t),{uuid:e})),i}return this.searchEngine.addList[e]=Object.assign(Object.assign({},this.searchEngine.addList[e]),t),this.searchEngine.addList[e]}delEngineAdd(t){return this.searchEngine.addList.splice(t,1),!0}async getEnginesList(){let t=this.version;this.lang!==h.D.lang&&(t="");const{data:e,error:i}=await u.d.getEnginesList(t);if(!i&&(Object(a.i)(()=>{var t;this.version=null===(t=e.meta)||void 0===t?void 0:t.version,this.lang=h.D.lang}),e.hash!==this.listHash))if(p.userStore.isLogin)this.updateEngines({list:e.list,listHash:e.hash});else{this.stopAutoBackupReaction();try{this.updateEngines({list:e.list,listHash:e.hash})}catch(i){}this.restartAutoBackupReaction()}}updateEngines({list:t,listHash:e}){this.list=t,this.listHash=e;const i={};t.forEach(t=>{i[t.uuid]=t});const s=this.searchEngine.current.uuid;i[s]&&(this.searchEngine.current=i[s]);const o=this.defaultSearch.uuid;i[o]&&(this.defaultSearch=i[o]);const n=[];this.searchEngine.all.forEach(t=>{const e=t.uuid;i[e]?0===t.updatetime?n.push(Object.assign(Object.assign({},i[e]),{updatetime:0})):n.push(Object.assign({},i[e])):n.push(t)}),this.searchEngine.all=n}sortShortcut(t,e){if(t===e)return;const i=[...this.searchEngine.all],s=i.findIndex(e=>e.uuid===t);if(-1!==s){if("all"===e){const[t]=i.splice(s,1);i.push(t)}else{const t=i.findIndex(t=>t.uuid===e);if(-1===t)return;const[o]=i.splice(s,1);i.splice(t,0,o)}this.searchEngine.all=i}}}g([a.g],m.prototype,"list",void 0),g([a.g],m.prototype,"defaultSearch",void 0),g([a.g],m.prototype,"listHash",void 0),g([a.g],m.prototype,"version",void 0),g([a.g],m.prototype,"lang",void 0),g([a.g],m.prototype,"ignoreSuggest",void 0),g([a.g],m.prototype,"searchEngine",void 0),g([a.e],m.prototype,"allItems",null),g([a.b],m.prototype,"mergeRemote",null),g([a.b],m.prototype,"setActive",null),g([a.b],m.prototype,"closeSuggestTips",null),g([a.b],m.prototype,"delShortcut",null),g([a.b],m.prototype,"updateShortcut",null),g([a.b],m.prototype,"createEngine",null),g([a.b],m.prototype,"delEngine",null),g([a.b],m.prototype,"createEngineAdd",null),g([a.b],m.prototype,"delEngineAdd",null),g([a.b],m.prototype,"getEnginesList",null),g([a.b],m.prototype,"updateEngines",null),g([a.b],m.prototype,"sortShortcut",null);const f=new m;f.initSyncStore(y.f,["searchEngine","list","listHash","ignoreSuggest","version","lang"],{list:l.g,searchEngine:{custom:[],addList:[],current:b,all:[Object.assign(Object.assign({},b),{updatetime:0}),Object.assign(Object.assign({},l.c),{updatetime:0})]}}),f.initAutoBackup("searcher",["searchEngine"]),Object(a.c)(()=>{f.firstSync&&f.getEnginesList()})},627:function(t,e,i){"use strict";i.d(e,"a",(function(){return p}));i(11),i(14),i(41),i(8);var s=i(4),o=i(401),n=i.n(o),r=i(263),a=i(23),c=i(17),l=i(9),d=function(t,e,i,s){var o,n=arguments.length,r=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(r=(n<3?o(r):n>3?o(e,i,r):o(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};const u=[{title:"",content:"",time:+new Date,id:"note-default-1ehj4oc7ubn8bgu9zb2spjip0vj",updatetime:0,fontSize:14}];class h extends r.a{constructor(){super(...arguments),this.linkModal=!1,this.list=u,this.checkedId=this.list[0].id,this.boldActive=!1}toogleLinkModal(){this.linkModal=!this.linkModal}setBoldActive(t){this.boldActive=t}get isEmpty(){return 0===this.list.length}get checkedNote(){return this.checkedId?this.list.filter(t=>t.id===this.checkedId)[0]:this.list[0]}get noteList(){const t=[],e=[];return this.list.forEach(i=>{i.sticky?t.push(i):e.push(i)}),t.concat(e)}diffRemote(t){const e=t=>{if(null==t?void 0:t.updatetime){const e={updatetime:void 0};return Object.assign(Object.assign({},t),e)}},i=n()(t.list||[],e),o=n()(Object(s.j)(this.list),e);return!s.d.structural(i,o)}mergeRemote(t,e){if(t.list)if(e)this.list=t.list,this.checkedId=t.checkedId;else{const e=this.list,i=t.list;this.checkedId=t.checkedId;const{result:s}=c.a.mergeArray(e,i);this.list=s}}async add({title:t="",content:e=""}){const i=c.a.randomId("note-"),o=await c.a.getTimestamp(),n={title:t,content:e,time:+new Date,id:i,updatetime:o,fontSize:14};Object(s.i)(()=>{this.list=[n,...this.list],this.checkedId=i})}delete(t){this.list=this.list.filter(e=>e.id!==t),t!==this.checkedId||this.isEmpty||(this.checkedId=this.list[0].id)}setTop(t){const e=this.list.findIndex(e=>e.id===t);if(-1!==e){const[t]=this.list.splice(e,1);t.sticky=!0,this.list.unshift(t)}}cancelSetTop(t){const e=this.list.findIndex(e=>e.id===t);if(-1!==e){const[t]=this.list.splice(e,1);t.sticky=!1,this.list.unshift(t)}}updateId(t){this.checkedId=t}async updateNote(t){const e=await c.a.getTimestamp();Object(s.i)(()=>{var i;(null===(i=this.list)||void 0===i?void 0:i.length)&&(this.list=this.list.map(i=>i.id===t.id?Object.assign(Object.assign(Object.assign({},i),t),{updatetime:e}):Object.assign({},i)))})}async upload(t,e){var i,s;const{data:o,error:n}=await a.f.uploadFile(t,e+".png","infinity-notes-img");if(n){return{error:(null===(s=null===(i=n.response)||void 0===i?void 0:i.data)||void 0===s?void 0:s.error)?n.response.data.error:n.message,data:""}}return{data:o,error:""}}}d([s.g],h.prototype,"linkModal",void 0),d([s.b],h.prototype,"toogleLinkModal",null),d([s.g],h.prototype,"list",void 0),d([s.g],h.prototype,"checkedId",void 0),d([s.g],h.prototype,"boldActive",void 0),d([s.b],h.prototype,"setBoldActive",null),d([s.e],h.prototype,"isEmpty",null),d([s.e],h.prototype,"checkedNote",null),d([s.e],h.prototype,"noteList",null),d([s.b],h.prototype,"mergeRemote",null),d([s.b],h.prototype,"add",null),d([s.b],h.prototype,"delete",null),d([s.b],h.prototype,"setTop",null),d([s.b],h.prototype,"cancelSetTop",null),d([s.b],h.prototype,"updateId",null),d([s.b],h.prototype,"updateNote",null),d([s.b],h.prototype,"upload",null);const p=new h;p.initSyncStore(l.d,["list","checkedId"],{}),p.initAutoBackup("note",["list","checkedId"])},636:function(t,e,i){"use strict";i.d(e,"a",(function(){return c}));i(11),i(14);var s=i(9),o=i(4),n=i(263),r=function(t,e,i,s){var o,n=arguments.length,r=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(r=(n<3?o(r):n>3?o(e,i,r):o(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};class a extends n.a{constructor(){super(...arguments),this.onlyOneItem=!1,this.ready=!1}initStore(){return this.initSyncStore(s.l,["onlyOneItem","ready","nextId","nextRawURL","nextURL","nextItem"])}setOnlyOneItem(t){this.onlyOneItem=t}setReady(t){this.ready=t}setNextId(t){this.nextId=t}setNextRawURL(t){this.nextRawURL=t}setNextURL(t){this.nextURL=t}setNextItem(t){this.nextItem=t}clearNextData(){this.nextURL=void 0,this.nextRawURL=void 0,this.nextId=void 0,this.nextItem=null}}r([o.g],a.prototype,"onlyOneItem",void 0),r([o.g],a.prototype,"ready",void 0),r([o.g],a.prototype,"nextId",void 0),r([o.g],a.prototype,"nextRawURL",void 0),r([o.g],a.prototype,"nextURL",void 0),r([o.g],a.prototype,"nextItem",void 0),r([o.b],a.prototype,"setOnlyOneItem",null),r([o.b],a.prototype,"setReady",null),r([o.b],a.prototype,"setNextId",null),r([o.b],a.prototype,"setNextRawURL",null),r([o.b],a.prototype,"setNextURL",null),r([o.b],a.prototype,"setNextItem",null),r([o.b],a.prototype,"clearNextData",null);const c=new a}}]);