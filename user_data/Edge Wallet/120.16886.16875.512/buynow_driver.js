!function(){"use strict";let e,t,i,s=!1;!function(e){e.IsBuyNowReady="IsBuyNowReady",e.BuyNowSubscribeNow="BuyNowSubscribeNow",e.BuyNowQuickAuthFinished="BuyNowQuickAuthFinished",e.BuyNowQuickAuthFailed="BuyNowQuickAuthFailed",e.BuyNowIsReady="BuyNowIsReady",e.BuyNowStartQuickAuth="BuyNowStartQuickAuth",e.BuyNowCheckoutFinished="BuyNowCheckoutFinished"}(t||(t={})),function(e){e.EntryPointReady="EntryPointReady",e.StartBuyNow="StartBuyNow",e.VisitPublisher="VisitPublisher",e.MerchantAuthSucceeded="MerchantAuthSucceeded",e.MerchantAuthFailed="MerchantAuthFailed"}(i||(i={}));const o="BuyNowRuntime";window[o]=new class{notifyHostPage(e,t){window.dispatchEvent(new CustomEvent(e,{detail:t}))}listenOnHostPageEvent(e,t){window.addEventListener(e,(e=>{t(e)}))}handleQuickAuthFinished(e){if(e.detail){const t=JSON.parse(e.detail);"skipped"===t.type?window[o].postMessageToHost(i.MerchantAuthFailed,[]):"display"!==t.type||t.displayed?"dismissed"===t.type&&"credential_returned"===t.reason&&window[o].postMessageToHost(i.MerchantAuthSucceeded,[]):window[o].postMessageToHost(i.MerchantAuthFailed,[])}}handleQuickAuthFailed(e){window[o].postMessageToHost(i.MerchantAuthFailed,[])}handleIsBuyNowReady(){window[o].notifyHostPage(t.BuyNowIsReady,"Ready"),window[o].postMessageToHost(i.EntryPointReady,[])}handleBuyNowSubscribeNow(t){window[o].postMessageToHost(i.StartBuyNow,[t.detail]),e=JSON.parse(t.detail)}raiseMessageFromHost(i){const s=i.shift(),n=JSON.parse(i[0]).event;if(s&&"StartMerchantAuth"===s)this.listenOnHostPageEvent(t.BuyNowQuickAuthFinished,this.handleQuickAuthFinished),this.listenOnHostPageEvent(t.BuyNowQuickAuthFailed,this.handleQuickAuthFailed),this.notifyHostPage(t.BuyNowStartQuickAuth,n);else if(s&&"VisitPublisher"===s){if(e&&e.plans){let t=0;for(let i=0;i<e.length;i+=1)if(e.plans[i].isPromotion){t=i;break}if(e.plans[t].url){const i=new URL(e.plans[t].url);window.open(i.origin,"_blank").focus()}}}else s&&"CheckoutFinished"===s&&window[o].notifyHostPage(t.BuyNowCheckoutFinished,n)}postMessageToHost(e,t){try{walletBuyNowNativeHandler&&walletBuyNowNativeHandler.sendMessageToHost(e,t)}catch(e){}}initialize(e){return s||(this.listenOnHostPageEvent(t.IsBuyNowReady,this.handleIsBuyNowReady),this.listenOnHostPageEvent(t.BuyNowSubscribeNow,this.handleBuyNowSubscribeNow),s=!0),!0}}}();